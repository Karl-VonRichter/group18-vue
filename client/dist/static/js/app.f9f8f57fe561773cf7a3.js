webpackJsonp([1],{"0jyg":function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__("Dd8w"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1_vuex__=__webpack_require__("NYxO"),__WEBPACK_IMPORTED_MODULE_2__jolecule_main__=__webpack_require__("bei4"),__WEBPACK_IMPORTED_MODULE_3_vee_validate__=__webpack_require__("sUu7");__webpack_exports__.a={computed:__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},Object(__WEBPACK_IMPORTED_MODULE_1_vuex__.c)(["energyCutoffSets","elements","searchQuery"]),{isWorking:{get:function(){return this.$store.state.isWorking},set:function(e){this.$store.commit("SET_ISWORKING",e)}},pdb:{get:function(){return this.$store.state.pdb},set:function(e){this.$store.commit("SET_PDB",e)}},energyCutoffSet:{get:function(){return this.$store.state.energyCutoffSet},set:function(e){if(e){var t=e.value?e.value:e;console.log("local","SET_ENERGYCUTOFFSET",e,t,this.isValidEnergyCutOffSet(t)),this.isValidEnergyCutOffSet(t)&&this.$store.commit("SET_ENERGYCUTOFFSET",t)}}}}),data:function(){return{query:{text:"",value:""},search:null,pdbSelectItems:[],querySelectItems:[],customFilter:function(e,t,i){return i},localEnergyCutoffSets:[]}},methods:__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},Object(__WEBPACK_IMPORTED_MODULE_1_vuex__.d)(["SET_PDB","SET_ENERGYCUTOFFSET"]),{isValidEnergyCutOffSet:function(e){var t=e.value?e.value:e;return console.log("local","isValidEnergyCutOffSet",e,t),"veryHigh"==t||"high"==t||"medium"==t||"low"==t||t<=-.5&&t>=-2},addDataServer:function addDataServer(_ref){var embededJolecule=_ref.embededJolecule,index=_ref.index,url="http://localhost:8081/api/dataServer/"+this.pdb+"/"+this.energyCutoffSet+"/"+index+"/";axios.get(url).then(function(response){var dataServerFn=response.data.replace("define(","("),dataServer=eval(dataServerFn);console.log("local","dataserver",dataServer()),embededJolecule.asyncAddDataServer(dataServer())})},querySelections:function(e){var t=this;this.isWorking=!0;var i="http://localhost:8081/api/nobleGasBindings/search?limit=100&query="+e;axios.get(i).then(function(e){console.log("local","autocompleteResults",e,e.data);var i=[];e.data.rows.forEach(function(e){console.log("local",e),i.push({text:"["+e.pdb+"]:"+e.protein_type+" - "+e.protein_description+" ("+e.binding_energy+" kcal/mol)",value:e.pdb})}),t.querySelectItems=i,t.isWorking=!1})},reDisplayJolecule:function(){document.getElementById("jolecule").innerHTML="";var e=Object(__WEBPACK_IMPORTED_MODULE_2__jolecule_main__.a)({divTag:"#jolecule",viewId:"",viewHeight:100,isLoop:!1,isGrid:!0,isEditable:!1}),t=window.location.protocol+"//"+window.location.host+"/#/view?pdb="+this.pdb+"&cutoff="+this.energyCutoffSet;console.log("local","newurl",t,window.location.href),window.location.href!=t&&(window.history.pushState(null,"",t),console.log("local","url updated",t)),this.pdbSelectItems.push(this.pdb),this.localEnergyCutoffSets.push(this.energyCutoffSet);for(var i=0;i<=5;i++)this.addDataServer({embededJolecule:e,pdb:this.pdb,energyCutoffSet:this.energyCutoffSet,index:i})},displayJolecule:function(){var e=this.$route.query.pdb,t=this.$route.query.cutoff;e&&e>""&&this.SET_PDB(e),t&&t>""&&this.SET_ENERGYCUTOFFSET(t),this.localEnergyCutoffSets=this.energyCutoffSets,this.localEnergyCutoffSets.push({text:this.energyCutoffSet,value:this.energyCutoffSet}),this.reDisplayJolecule()}}),watch:{search:function(e){e&&this.querySelections(e)},query:function(e){e.text&&e.value&&(this.pdbSelectItems=[this.pdb],this.pdb=e.value)},energyCutoffSet:{handler:function(){this.reDisplayJolecule()},deep:!0},pdb:{handler:function(){this.reDisplayJolecule()},deep:!0},$route:{handler:function(){console.log("local","route change",this.$route,window.history),this.displayJolecule()},deep:!0}},mounted:function(){var e=this;__WEBPACK_IMPORTED_MODULE_3_vee_validate__.a.extend("isValidEnergyCutOffSet",{getMessage:function(e){return"The "+e+" value is not a valid cutoff."},validate:function(t){return e.isValidEnergyCutOffSet(t)}}),this.displayJolecule()}}},"7zck":function(e,t){},"9Jgb":function(e,t){},DHEh:function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("Xxa5"),r=i.n(s),n=i("exGp"),a=i.n(n),o=i("7+uW"),u=i("3EgV"),l=i.n(u),h="http://localhost:3000",c="PlasticGui",d=!0,v=i("mvHQ"),p=i.n(v),f=i("M4fF"),m=i.n(f),g=i("0hgu"),w=i.n(g),y=i("BO1k"),_=i.n(y),b=(i("//Fk"),function(e){return p()(e,null,2)}),x=i("Gu7T"),k=i.n(x),C=i("mtWM"),S=i.n(C),V=i("lDdF"),P=i.n(V);S.a.defaults.withCredentials=!0;var A={rpcRun:function(e){for(var t=this,i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];return a()(r.a.mark(function i(){var n,a,o;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={method:e,params:s,jsonrpc:"2.0"},(n=console).log.apply(n,["> rpc.rpcRun",e].concat(k()(s))),t.prev=2,t.next=5,S.a.post(h+"/api/rpc-run",a);case 5:return o=t.sent,t.abrupt("return",o.data);case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",{error:{code:-32e3,message:t.t0.toString()}});case 12:case"end":return t.stop()}},i,t,[[2,9]])}))()},rpcUpload:function(e,t){for(var i=arguments.length,s=Array(i>2?i-2:0),n=2;n<i;n++)s[n-2]=arguments[n];var o=this;return a()(r.a.mark(function i(){var n,a,u,l,c,d,v,f,m;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for((a=new FormData).append("method",e),a.append("params",p()(s)),a.append("jsonrpc","2.0"),u=!0,l=!1,c=void 0,i.prev=7,d=_()(t);!(u=(v=d.next()).done);u=!0)f=v.value,a.append("uploadFiles",f,f.name);i.next=15;break;case 11:i.prev=11,i.t0=i.catch(7),l=!0,c=i.t0;case 15:i.prev=15,i.prev=16,!u&&d.return&&d.return();case 18:if(i.prev=18,!l){i.next=21;break}throw c;case 21:return i.finish(18);case 22:return i.finish(15);case 23:return(n=console).log.apply(n,["> rpc.rpcUpoad",e,t].concat(k()(s))),i.prev=24,i.next=27,S.a.post(h+"/api/rpc-upload",a);case 27:return m=i.sent,i.abrupt("return",m.data);case 31:return i.prev=31,i.t1=i.catch(24),i.abrupt("return",{error:{code:-32e3,message:i.t1.toString()}});case 34:case"end":return i.stop()}},i,o,[[7,11,15,23],[16,,18,22],[24,31]])}))()},rpcDownload:function(e){for(var t=this,i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];return a()(r.a.mark(function i(){var n,a,o,u,l,c;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={method:e,params:s,jsonrpc:"2.0"},(n=console).log.apply(n,["> rpc.rpcDownload"].concat(k()(s))),t.prev=2,t.next=5,S.a.post(h+"/api/rpc-download",a);case 5:return o=t.sent,u=o.headers.filename,l=JSON.parse(o.headers.data),console.log("> rpc.rpcDownload response",l),l.error||(c=new Blob([o.data]),P.a.saveAs(c,u)),t.abrupt("return",l);case 13:return t.prev=13,t.t0=t.catch(2),t.abrupt("return",{error:{code:-32e3,message:t.t0.toString()}});case 16:case"end":return t.stop()}},i,t,[[2,13]])}))()}},T=i("olkN");function R(e){var t=m.a.cloneDeep(e);return!t.password&&t.rawPassword&&(t.password=w()(t.rawPassword).toString(),delete t.rawPassword),t.rawPasswordConfirm&&delete t.rawPasswordConfirm,t}var D={login:function(e){var t=this;return a()(r.a.mark(function i(){var s,n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=R(e),console.log("> auth.login",s),t.next=4,A.rpcRun("publicLoginUser",s);case 4:return n=t.sent,console.log("> auth.login response",n),n.result&&(a=m.a.cloneDeep(T.a.state.user),m.a.assign(a,n.result.user),a.authenticated=!0,a.password=s.password,localStorage.setItem("user",b(a)),T.a.commit("setUser",a)),t.abrupt("return",n);case 8:case"end":return t.stop()}},i,t)}))()},register:function(e){var t=R(e);return console.log("> auth.register",t),A.rpcRun("publicRegisterUser",t)},update:function(e){var t=this;return a()(r.a.mark(function i(){var s,n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=R(e),console.log("> auth.update",b(s)),t.next=4,A.rpcRun("loginUpdateUser",s);case 4:return(n=t.sent).result&&(a=m.a.cloneDeep(T.a.state.user),m.a.assign(a,s),localStorage.setItem("user",p()(a)),T.a.commit("setUser",a)),t.abrupt("return",n);case 7:case"end":return t.stop()}},i,t)}))()},resetPassword:function(e,t){var i=this;return a()(r.a.mark(function s(){var n;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=w()(t).toString(),console.log("> auth.resetPassword",e,n),i.abrupt("return",A.rpcRun("publicForceUpdatePassword",e,n));case 3:case"end":return i.stop()}},s,i)}))()},restoreLastUser:function(){var e=this;return a()(r.a.mark(function t(){var i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=JSON.parse(localStorage.getItem("user")),console.log("> auth.restoreLastUser from localStorage",i),!i){t.next=4;break}return t.abrupt("return",e.login(i));case 4:case"end":return t.stop()}},t,e)}))()},logout:function(){return localStorage.removeItem("user"),T.a.commit("setUser",{authenticated:!1}),A.rpcRun("publicLogoutUser")}},E=(i("7zck"),{name:"navbar",data:function(){return{title:c,isUser:d}},computed:{user:function(){return this.$store.state.user}},methods:{editUser:function(){this.$router.push("/edit-user")},home:function(){this.$router.push("/")},logout:function(){var e=this;return a()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.logout();case 2:e.$router.push("/login");case 3:case"end":return t.stop()}},t,e)}))()}}}),M={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-toolbar",[i("h2",{staticClass:"v-title",staticStyle:{"padding-left":"1em",cursor:"pointer",flex:"1"},on:{click:function(t){e.home()}}},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),i("v-tabs",{attrs:{dark:""}},[i("v-tab",{attrs:{id:"tab-home",to:"/home",router:""}},[e._v("Home\n    ")]),e._v(" "),i("v-tab",{attrs:{id:"tab-search",to:"/search",router:""}},[e._v("Search\n    ")]),e._v(" "),i("v-tab",{attrs:{id:"tab-view",to:"/view",router:""}},[e._v("View\n    ")])],1),e._v(" "),e.isUser?i("div",[e.user.authenticated?i("v-menu",[i("v-btn",{directives:[{name:"menu-trigger",rawName:"v-menu-trigger"}]},[e._v("\n        "+e._s(e.user.name)+"\n      ")]),e._v(" "),i("v-menu-content",[i("v-menu-item",{on:{click:e.editUser}},[e._v("\n          Edit User\n        ")]),e._v(" "),i("v-menu-item",{on:{click:e.logout}},[e._v("\n          Logout\n        ")])],1)],1):i("router-link",{attrs:{to:"/login",tag:"v-btn"}},[e._v("\n      Login\n    ")])],1):e._e()],1)},staticRenderFns:[]};var O={name:"app",components:{Navbar:i("VU/8")(E,M,!1,function(e){i("WQOK")},"data-v-d1348cd4",null).exports}},I={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("navbar"),this._v(" "),t("router-view")],1)},staticRenderFns:[]};var B=i("VU/8")(O,I,!1,function(e){i("DHEh")},null,null).exports,L=i("/ocq"),z={name:"Login",data:function(){return{title:c,email:"",rawPassword:"",error:"",passwordHidden:!0}},methods:{submit:function(){var e=this;return a()(r.a.mark(function t(){var i,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={email:e.$data.email,rawPassword:e.$data.rawPassword},console.log("> Login.submit",i),t.next=4,D.login(i);case 4:s=t.sent,console.log("> Login.submit response",s),s.result?e.$router.push("/"):e.error=s.error.message;case 7:case"end":return t.stop()}},t,e)}))()}}},U={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-layout",{directives:[{name:"align",rawName:"v-align",value:e.center,expression:"center"}]},[i("v-card",[i("v-layout",{directives:[{name:"flex",rawName:"v-flex",value:50,expression:"50"},{name:"align",rawName:"v-align",value:e.center,expression:"center"},{name:"column",rawName:"v-column"}]},[i("v-toolbar",[i("v-toolbar-title",[e._v("Login to "+e._s(e.title))])],1),e._v(" "),i("v-card-text",[i("form",{staticClass:"login-screen",attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[i("v-container",{attrs:{fluid:"","grid-list-xl":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{staticClass:"xs12"},[i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"email",expression:"'email'"}],attrs:{label:"email","error-messages":e.errors.collect("email"),"data-vv-name":"email"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|min:6",expression:"'required|min:6'"}],attrs:{hint:"At least 6 characters","append-icon":e.passwordHidden?"visibility":"visibility_off","append-icon-cb":function(){return e.passwordHidden=!e.passwordHidden},type:e.passwordHidden?"password":"text",counter:"",label:"password","error-messages":e.errors.collect("password"),"data-vv-name":"password"},model:{value:e.rawPassword,callback:function(t){e.rawPassword=t},expression:"rawPassword"}}),e._v(" "),i("p",[i("a",{attrs:{href:"/forgotPassword"}},[e._v("Forgot")]),e._v(" your password?   ")]),e._v(" "),i("div",{staticClass:"alert alert-danger"},[e._v(e._s(e.loginMessage))])],1)],1),e._v(" "),i("v-btn",{staticClass:"v-accent",attrs:{type:"submit"}},[e._v("Sign in")]),e._v(" "),i("v-btn",{staticClass:"v-primary",attrs:{type:"button"},on:{click:e.clearForm}},[e._v("Cancel")]),e._v(" "),e.error?i("div",{staticStyle:{color:"red"}},[e._v("\n            "+e._s(e.error)+"\n          ")]):e._e(),e._v(" "),i("div",{staticStyle:{"margin-top":"3em"}},[e._v("\n            New to "+e._s(e.title)+"?  \n            "),i("router-link",{attrs:{to:"/register"}},[e._v("Register")])],1)],1)],1)])],1)],1)],1)},staticRenderFns:[]},N=i("VU/8")(z,U,!1,null,null,null).exports,F={name:"Register",data:function(){return{title:c,name:"",email:"",rawPassword:"",rawPasswordConfirm:"",user:D.user,error:""}},methods:{submit:function(){var e=this;return a()(r.a.mark(function t(){var i,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={name:e.$data.name,email:e.$data.email,rawPassword:e.$data.rawPassword,rawPasswordConfirm:e.$data.rawPasswordConfirm},t.next=3,D.register(i);case 3:if(!(s=t.sent).result){t.next=9;break}return console.log("> Register.submit register success",s.result),t.next=8,D.login({email:i.email,rawPassword:i.rawPassword});case 8:s=t.sent;case 9:s.result?(console.log("> Register.submit login success",s.result),e.$router.push("/")):(console.log("> Register.submit fail",s.error),e.error=s.error.message);case 10:case"end":return t.stop()}},t,e)}))()}}},W={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("md-layout",{attrs:{"md-align":"center"}},[i("md-whiteframe",{staticStyle:{"margin-top":"4em",padding:"3em"}},[i("md-layout",{attrs:{"md-flex":"50","md-align":"center","md-column":""}},[i("h2",{staticClass:"md-display-2"},[e._v("\n        Register to "+e._s(e.title)+"\n      ")]),e._v(" "),i("form",{on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[i("md-input-container",[i("label",[e._v("User name")]),e._v(" "),i("md-input",{attrs:{type:"text",placeholder:"User name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("E-mail address")]),e._v(" "),i("md-input",{attrs:{type:"text",placeholder:"E-mail address"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"Password"},model:{value:e.rawPassword,callback:function(t){e.rawPassword=t},expression:"rawPassword"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("Confirm Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"Confirm Password"},model:{value:e.rawPasswordConfirm,callback:function(t){e.rawPasswordConfirm=t},expression:"rawPasswordConfirm"}})],1),e._v(" "),i("md-button",{staticClass:"md-raised md-primary",attrs:{type:"submit"}},[e._v("\n          Register\n        ")]),e._v(" "),e.error?i("div",{staticStyle:{color:"red"}},[e._v("\n          "+e._s(e.error)+"\n        ")]):e._e()],1)])],1)],1)},staticRenderFns:[]},H=i("VU/8")(F,W,!1,null,null,null).exports,G={name:"EditUser",data:function(){var e={};return m.a.assign(e,this.$store.state.user),m.a.assign(e,{title:"Edit Your Details",rawPassword:"",rawPasswordConfirm:"",error:""}),e},methods:{submit:function(){var e=this;return a()(r.a.mark(function t(){var i,s,n,a,o,u,l,h,c;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e.error="",i={},s=["id","name","email","rawPassword","rawPasswordConfirm"],n=!0,a=!1,o=void 0,t.prev=6,u=_()(s);!(n=(l=u.next()).done);n=!0)h=l.value,e.$data[h]&&(i[h]=e.$data[h]);t.next=14;break;case 10:t.prev=10,t.t0=t.catch(6),a=!0,o=t.t0;case 14:t.prev=14,t.prev=15,!n&&u.return&&u.return();case 17:if(t.prev=17,!a){t.next=20;break}throw o;case 20:return t.finish(17);case 21:return t.finish(14);case 22:return t.next=24,D.update(i);case 24:(c=t.sent).result?e.error="User updated":(console.log("> EditUser.submit fail",c),e.error=c.error.message);case 26:case"end":return t.stop()}},t,e,[[6,10,14,22],[15,,17,21]])}))()}}},j={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("md-layout",{attrs:{"md-align":"center"}},[i("md-whiteframe",{staticStyle:{"margin-top":"4em",padding:"3em"}},[i("md-layout",{attrs:{"md-flex":"50","md-align":"center","md-column":""}},[i("h2",{staticClass:"md-display-2"},[e._v("\n        "+e._s(e.title)+"\n      ")]),e._v(" "),i("form",{on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[i("md-input-container",[i("label",[e._v("User name")]),e._v(" "),i("md-input",{attrs:{type:"text",placeholder:"User name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("E-mail address")]),e._v(" "),i("md-input",{attrs:{type:"text",placeholder:"E-mail address"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("New Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"New Password"},model:{value:e.rawPassword,callback:function(t){e.rawPassword=t},expression:"rawPassword"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("Confirm Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"Confirm Password"},model:{value:e.rawPasswordConfirm,callback:function(t){e.rawPasswordConfirm=t},expression:"rawPasswordConfirm"}})],1),e._v(" "),i("md-button",{staticClass:"md-raised md-primary",attrs:{type:"submit"}},[e._v("\n          Save\n        ")]),e._v(" "),e.error?i("div",{staticStyle:{color:"red"}},[e._v("\n          "+e._s(e.error)+"\n        ")]):e._e()],1)])],1)],1)},staticRenderFns:[]},Y=i("VU/8")(G,j,!1,null,null,null).exports,K={name:"AdminUser",data:function(){return{users:[]}},mounted:function(){var e=this;return a()(r.a.mark(function t(){var i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A.rpcRun("adminGetUsers");case 2:(i=t.sent).result&&(console.log("> AdminUsers.mounted users",i.result.users),e.users=i.result.users);case 4:case"end":return t.stop()}},t,e)}))()},methods:{deleteUser:function(e){var t=this;return a()(r.a.mark(function i(){var s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,A.rpcRun("adminDeleteUser",e);case 2:(s=i.sent).result&&(console.log("> AdminUsers.deleteUser remaining",s.result.users),t.users=s.result.users);case 4:case"end":return i.stop()}},i,t)}))()}}},Q={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{padding:"10px"}},[i("h2",{staticClass:"md-display-2"},[e._v("\n    Users\n  ")]),e._v(" "),i("md-list",e._l(e.users,function(t){return i("md-list-item",{key:t.id},[e._v("\n      "+e._s(t.name)+" - "+e._s(t.email)+"\n      "),i("md-button",{on:{click:function(i){e.deleteUser(t.id)}}},[i("md-icon",{attrs:{"md-mini":""}},[e._v("\n          delete\n        ")])],1)],1)}))],1)},staticRenderFns:[]},q=i("VU/8")(K,Q,!1,null,null,null).exports,$={name:"ResetPassword",data:function(){var e=this.$route.params.tokenId;return console.log("> ResetPassword tokenId="+e),{title:"Reset Password",tokenId:e,rawPassword:"",rawPasswordConfirm:"",error:""}},methods:{submit:function(){var e=this;return a()(r.a.mark(function t(){var i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.error="",t.next=3,D.resetPassword(e.tokenId,e.rawPassword);case 3:(i=t.sent).result?e.error="Password reset":(console.log("> ResetPassword.submit fail",i),e.error=i.error.message);case 5:case"end":return t.stop()}},t,e)}))()}}},X={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("md-layout",{attrs:{"md-align":"center"}},[i("md-whiteframe",{staticStyle:{"margin-top":"4em",padding:"3em"}},[i("md-layout",{attrs:{"md-flex":"50","md-align":"center","md-column":""}},[i("h2",{staticClass:"md-display-2"},[e._v("\n        "+e._s(e.title)+"\n      ")]),e._v(" "),i("form",{on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[i("md-input-container",[i("label",[e._v("New Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"New Password"},model:{value:e.rawPassword,callback:function(t){e.rawPassword=t},expression:"rawPassword"}})],1),e._v(" "),i("md-input-container",[i("label",[e._v("Confirm Password")]),e._v(" "),i("md-input",{attrs:{type:"password",placeholder:"Confirm Password"},model:{value:e.rawPasswordConfirm,callback:function(t){e.rawPasswordConfirm=t},expression:"rawPasswordConfirm"}})],1),e._v(" "),i("md-button",{staticClass:"md-raised md-primary",attrs:{type:"submit"}},[e._v("\n          Save\n        ")]),e._v(" "),e.error?i("div",{staticStyle:{color:"red"}},[e._v("\n          "+e._s(e.error)+"\n        ")]):e._e()],1)])],1)],1)},staticRenderFns:[]},J=i("VU/8")($,X,!1,null,null,null).exports,Z=i("Dd8w"),ee=i.n(Z),te=i("NYxO"),ie={name:"search-form",computed:ee()({},Object(te.c)(["isWorking","isSubmitted","searchQuery","searchErrors","elements"])),methods:ee()({},Object(te.d)(["SET_ISSUBMITTED","SET_SEARCHQUERY"]),Object(te.b)(["search"]),{clearForm:function(){this.SET_ISSUBMITTED(!1),this.SET_SEARCHQUERY({}),this.errors.clear(),this.search()}})},se={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{staticClass:"v-layout",attrs:{method:"POST",action:"http://localhost:8081/api/nobleGasBindings/search"},on:{submit:function(t){return t.preventDefault(),e.search(t)}}},[i("v-card",{staticClass:"v-layout-item v-elevation-3"},[i("v-toolbar",[i("v-toolbar-title",[e._v("Query")])],1),e._v(" "),i("v-card-text",[i("v-container",{attrs:{fluid:"","grid-list-xl":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{staticClass:" xs12 sm6 md3"},[i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"max:4",expression:"'max:4'"}],attrs:{label:"PDB","error-messages":e.errors.collect("pdb"),"data-vv-name":"pdb"},model:{value:e.searchQuery.pdb,callback:function(t){e.$set(e.searchQuery,"pdb",t)},expression:"searchQuery.pdb"}}),e._v(" "),i("v-subheader",[e._v("N Atoms")]),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"numeric",expression:"'numeric'"}],attrs:{label:"Min","error-messages":e.errors.collect("min_n_atoms"),"data-vv-name":"min_n_atoms"},model:{value:e.searchQuery.min_n_atoms,callback:function(t){e.$set(e.searchQuery,"min_n_atoms",t)},expression:"searchQuery.min_n_atoms"}}),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"numeric",expression:"'numeric'"}],attrs:{label:"Max","error-messages":e.errors.collect("max_n_atoms"),"data-vv-name":"max_n_atoms"},model:{value:e.searchQuery.max_n_atoms,callback:function(t){e.$set(e.searchQuery,"max_n_atoms",t)},expression:"searchQuery.max_n_atoms"}})],1),e._v(" "),i("v-flex",{staticClass:"  xs12 sm6 md3"},[i("v-subheader",[e._v("\n              Binding Site\n            ")]),e._v(" "),i("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{label:"Select",items:e.elements,"error-messages":e.errors.collect("element"),"data-vv-name":"element"},model:{value:e.searchQuery.element,callback:function(t){e.$set(e.searchQuery,"element",t)},expression:"searchQuery.element"}}),e._v(" "),i("v-subheader",[e._v("\n              Binding Energy (kcal/mol)          \n            ")]),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"regex:^-?\\d*(\\.\\d+)?$",expression:"'regex:^-?\\\\d*(\\\\.\\\\d+)?$'"}],attrs:{label:"Min","error-messages":e.errors.collect("min_binding_energy"),"data-vv-name":"min_binding_energy"},model:{value:e.searchQuery.min_binding_energy,callback:function(t){e.$set(e.searchQuery,"min_binding_energy",t)},expression:"searchQuery.min_binding_energy"}}),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"regex:^-?\\d*(\\.\\d+)?$",expression:"'regex:^-?\\\\d*(\\\\.\\\\d+)?$'"}],attrs:{label:"Max","error-messages":e.errors.collect("max_binding_energy"),"data-vv-name":"max_binding_energy"},model:{value:e.searchQuery.max_binding_energy,callback:function(t){e.$set(e.searchQuery,"max_binding_energy",t)},expression:"searchQuery.max_binding_energy"}})],1),e._v(" "),i("v-flex",{staticClass:"  xs12 sm6 md3"},[i("v-subheader",[e._v("Protein")]),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{label:"Type","error-messages":e.errors.collect("protein_type"),"data-vv-name":"protein_type"},model:{value:e.searchQuery.protein_type,callback:function(t){e.$set(e.searchQuery,"protein_type",t)},expression:"searchQuery.protein_type"}}),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{label:"Description","error-messages":e.errors.collect("protein_description"),"data-vv-name":"protein_description"},model:{value:e.searchQuery.protein_description,callback:function(t){e.$set(e.searchQuery,"protein_description",t)},expression:"searchQuery.protein_description"}})],1),e._v(" "),i("v-flex",{staticClass:"  xs12 sm6 md3"},[i("v-subheader",[i("v-checkbox",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{label:"Ligand","error-messages":e.errors.collect("has_ligand"),"data-vv-name":"has_ligand"},model:{value:e.searchQuery.has_ligand,callback:function(t){e.$set(e.searchQuery,"has_ligand",t)},expression:"searchQuery.has_ligand"}})],1),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"max:3",expression:"'max:3'"}],attrs:{label:"Component Id","error-messages":e.errors.collect("ligand"),"data-vv-name":"ligand"},model:{value:e.searchQuery.ligand,callback:function(t){e.$set(e.searchQuery,"ligand",t)},expression:"searchQuery.ligand"}}),e._v(" "),i("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{label:"Name","error-messages":e.errors.collect("ligand_name"),"data-vv-name":"ligand_name"},model:{value:e.searchQuery.ligand_name,callback:function(t){e.$set(e.searchQuery,"ligand_name",t)},expression:"searchQuery.ligand_name"}})],1)],1),e._v(" "),i("v-btn",{staticClass:"v-accent",attrs:{type:"submit"}},[e._v("SEARCH")]),e._v(" "),i("v-btn",{staticClass:"v-primary",attrs:{type:"button"},on:{click:e.clearForm}},[e._v("Cancel")])],1)],1)],1)],1)},staticRenderFns:[]};var re=i("VU/8")(ie,se,!1,function(e){i("mUlb")},"data-v-2c98c28e",null).exports,ne={data:function(){return{headers:[{text:"Element",value:"element"},{text:"PDB",value:"pdb"},{text:"N Atoms",value:"n_atoms"},{text:"Binding Energy (kcal/mol)",value:"binding_energy"},{text:"Ligand Name",value:"ligand_name"},{text:"Ligand Id",value:"ligand"},{text:"Type",value:"protein_type"},{text:"Description",value:"protein_description"}],pageSizes:[5,10,25]}},computed:ee()({},Object(te.c)(["isWorking","searchQuery","searchErrors","searchResults","totalResults"]),{pagination:{get:function(){return this.$store.state.searchPagination},set:function(e){this.$store.commit("SET_SEARCHPAGINATION",e)}},pages:function(){return console.log(this.pagination),this.pagination.rowsPerPage?Math.ceil(this.pagination.totalResults/this.pagination.rowsPerPage):0}}),methods:ee()({},Object(te.d)(["SET_ISSUBMITTED","SET_SEARCHPAGINATION"]),Object(te.b)(["search"]),{onSort:function(e){return this.search(),e}}),watch:{pagination:{handler:function(){this.search()},deep:!0}}},ae={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-card",{staticClass:"md-layout-item md-elevation-3"},[i("v-toolbar",[i("v-toolbar-title",[e._v("Results")])],1),e._v(" "),i("v-card-text",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.searchResults,search:e.search,pagination:e.pagination,"total-items":e.totalResults,loading:e.isWorking,"hide-actions":""},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return[i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.element))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[i("a",{attrs:{href:"/#/view?pdb="+t.item.pdb}},[e._v(e._s(t.item.pdb))])]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.n_atoms))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.binding_energy))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.ligand_name))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.ligand))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein_type))]),e._v(" "),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein_description))])]}}])},[i("template",{slot:"no-data"},[i("v-alert",{attrs:{value:!0,color:"error",icon:"warning"}},[e._v("\n        No matching binding sites found for this search `"+e._s(this.searchErrors)+"`\n      ")])],1)],2),e._v(" "),i("v-layout",[i("v-flex",{attrs:{xs12:"",sm9:"","offset-sm3":"",md6:"","offset-md6":"",lg3:"","offset-lg9":""}},[i("v-layout",[i("v-flex",{attrs:{xs2:""}},[i("v-select",{attrs:{items:e.pageSizes,label:"Page Size","single-line":""},model:{value:e.pagination.rowsPerPage,callback:function(t){e.$set(e.pagination,"rowsPerPage",t)},expression:"pagination.rowsPerPage"}})],1),e._v(" "),i("v-flex",{attrs:{xs10:""}},[i("v-pagination",{attrs:{length:e.pages,"total-visible":"7"},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})],1)],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var oe={components:{"search-form":re,"search-list":i("VU/8")(ne,ae,!1,function(e){i("9Jgb")},"data-v-15501fee",null).exports}},ue={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"v-layout v-gutter v-alignment-top-center"},[t("div",{staticClass:"v-layout-item v-size-95"},[t("search-form")],1),this._v(" "),t("div",{staticClass:"v-layout-item v-size-95"},[t("search-list")],1)])])},staticRenderFns:[]};var le=i("VU/8")(oe,ue,!1,function(e){i("a9sO")},"data-v-33b22a6c",null).exports,he={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-layout",{staticClass:"text-xs-left"},[i("v-container",{attrs:{fluid:"","grid-list-xl":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:"",sm9:""}},[i("v-card",[i("v-toolbar",[i("v-toolbar-title",[e._v("About")])],1),e._v(" "),i("v-card-text",[i("p",[e._v("\n      As outlined in the review\n      "),i("a",{attrs:{href:"https://www.ncbi.nlm.nih.gov/pubmed/26896563"}},[e._v("\n        ”The diverse biological properties of the chemically inert noble gases” (Winkler et al., 2016)\n      ")]),e._v(" there is a need to explore the possible interactions between the noble gases and proteins in order to provide\n      viable candidates for clinical study. The drive behind the generation of this data is to provide a starting point\n      for such exploration.\n    ")]),e._v(" "),i("p",[e._v("The datasets accessible from this page were created using AutoGrid4 to systematically map the energy of five noble\n      gas (He, Ne, Ar, Kr, Xe) at all grid locations (in 0.375 Å steps) in all ~60,000 unique PDB structures filtered by\n      100% sequence similarity. This retains the highest resolution structure where multiple structures of the same proteins\n      exist.\n    ")]),e._v(" "),i("p",[e._v("\n      Before the grid calculations, the proteins were carefully prepared using an automatic script to remove water and other solvents,\n      small molecule ligands such as drugs, metal and small inorganic ions except those important for protein function,\n      and small molecules except cofactors etc. essential for function. Given the very large number of proteins studied,\n      it was not practical to hand curate each protein. Where structures included small molecular effectors e.g. enzyme\n      substrates, products, inhibitors, or receptor agonists or antagonists, the proximity of the noble gas binding to\n      the small molecule ligand binding site is available.\n    ")]),e._v(" "),i("p",[e._v("\n      For ease of navigation, each dataset has been divided into ‘high’, ‘medium’, and ‘low’ subsets, based on the lowest energy\n      (kcal/mol) in each map. Thus, structures in the ‘low’ subset are those where noble gases do not appear to make any\n      favorable interactions. The probability of productive binding relative to thermal energy is quantified by Natural\n      information units (Nats) that are related to the Boltzmann distribution. Interactions with larger Nat values and\n      smaller ligand distances are more likely to be interesting pharmacologically. Clearly, noble gases that bind with\n      small energies that are comparable to thermal energies will not remain bound for long enough to affect the function\n      of the protein.\n    ")]),e._v(" "),i("p",[e._v("\n      Clicking one of these datasets from the data tab opens the results in a Google Spreadsheet, allowing you to use text search\n      or sort to find map files of particular interest.\n    ")]),e._v(" "),i("p",[e._v("\n      You can see the maps directly, either by clicking on a PDB Id. in the Google Spreadsheets (below), or by typing in a PDB\n      Id. in the field above. Note that not all PDBs have been mapped. Multiple structures of the same protein are represented\n      by the structure with the best resolution, some proteins with unusual functions (e.g. binding to DNA or RNA) may\n      be missing, and a very small percentage of proteins were not processed correctly by the automatic protein preparation\n      scripts. Protein multimers were not separated into the monomeric species but mapped as the multimer.\n    ")]),e._v(" "),i("p",[e._v("\n      The data is displayed using the 3D protein viewer\n      "),i("a",{attrs:{href:"http://jolecule.appspot.com/"}},[e._v("\n        Jolecule\n      ")])]),e._v(" "),i("p",[e._v("\n      Jolecule optimizes a simple but rich interface that focuses on stereochemistry. The focus is on Richardson ribbons that join\n      with sidechains correctly. Ligands are rendered as balls-and-sticks to allow the stereochemistry to be seen clearly,\n      as well as arrows that are used to indicate directionality on both protein and DNA chains.\n    ")]),e._v(" "),i("p",[e._v("Basic controls include:\n      "),i("br"),e._v(" ZOOM: Right-Mouse, or Shift-Left-Mouse, or Pinch-Zoom\n      "),i("br"),e._v(" DISTANCE LABELS: Drag from central atom\n      "),i("br"),e._v(" ATOM LABELS: Double click on central atom\n      "),i("br")]),e._v(" "),i("br"),e._v(" "),i("p",[i("img",{attrs:{id:"jolecule_image",src:"/static/assets/group18_jolecule_help.png",alt:"About Jolecule"}})])])],1)],1),e._v(" "),i("v-flex",{attrs:{xs12:"",sm3:""}},[i("v-card",[i("v-toolbar",[i("v-toolbar-title",[e._v("API")])],1),e._v(" "),i("v-card-text",[i("p",[e._v("\n    You can directly access specific PDB records using:"),i("br"),e._v(" "),i("br"),e._v(" "),i("strong",[i("a",{attrs:{href:"/#/view?pdb=2bmm"}},[e._v("\n        /#/view?pdb=2bmm")])]),e._v(" "),i("br"),e._v(" "),i("br"),e._v("\n    Just replace ‘2bmm’ with any 4-letter PDB identifier."),i("br"),e._v(" "),i("br"),e._v("\n\n    By default, noble gases are shown only in positions that are energetically favourable (i.e., energy cutoff = “high”)."),i("br"),e._v(" "),i("br"),e._v(" "),i("strong",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=high"}},[e._v("\n        /#/view?pdb=2bmm&cutoff=high")])]),e._v(" "),i("br"),e._v(" "),i("br"),e._v("The available cutoffs (in kcal/mol) are listed below and may also include any number between -0.5 and -2.0:"),i("br"),e._v(" "),i("br"),e._v(" "),i("table",{attrs:{id:"cutoffTable"}},[i("tr",[i("th",[e._v("cutoff")]),e._v(" "),i("th",[e._v("He")]),e._v(" "),i("th",[e._v("Ne")]),e._v(" "),i("th",[e._v("Ar")]),e._v(" "),i("th",[e._v("Kr")]),e._v(" "),i("th",[e._v("Xe")])]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=veryHigh"}},[e._v("veryHigh")])]),e._v(" "),i("td",[e._v("-0.6")]),e._v(" "),i("td",[e._v("-0.6")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.5")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=high"}},[e._v("high")])]),e._v(" "),i("td",[e._v("-0.4")]),e._v(" "),i("td",[e._v("-0.4")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-1.3")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=medium"}},[e._v("medium")])]),e._v(" "),i("td",[e._v("-0.3")]),e._v(" "),i("td",[e._v("-0.3")]),e._v(" "),i("td",[e._v("-0.8")]),e._v(" "),i("td",[e._v("-0.8")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=low"}},[e._v("low")])]),e._v(" "),i("td",[e._v("-0.3")]),e._v(" "),i("td",[e._v("-0.3")]),e._v(" "),i("td",[e._v("-0.6")]),e._v(" "),i("td",[e._v("-0.6")]),e._v(" "),i("td",[e._v("-0.8")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=-0.9"}},[e._v("-0.9")])]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td",[e._v("-0.9")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("th",[i("a",{attrs:{href:"/#/view?pdb=2bmm&cutoff=-1.2"}},[e._v("-1.2")])]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.2")]),e._v(" "),i("td",[e._v("-1.2 ")])]),e._v(" "),i("tr",[i("th",{staticStyle:{"text-align":"right"},attrs:{colspan:"6"}},[i("i",[e._v("etc...")])])])])]),i("div",{staticClass:"date_published"},[e._v("May 17, 2017")])])],1),e._v(" "),i("v-card",{staticClass:"panel body-side",attrs:{id:"contact",name:"contact"}},[i("v-toolbar",[i("v-toolbar-title",[e._v("Contacts")])],1),e._v(" "),i("v-card-text",[i("table",{attrs:{id:"contact-table"}},[i("tr",[i("th",{attrs:{colspan:"2"}},[e._v("Re: datasets")])]),e._v(" "),i("tr",[i("td",[e._v("Name:")]),e._v(" "),i("td",[e._v("Mr Aaron Thornton")])]),e._v(" "),i("tr",[i("td",[e._v("Position:")]),e._v(" "),i("td",[e._v("Senior Research Scientist, Manufacturing")])]),e._v(" "),i("tr",[i("td",[e._v("Email:")]),e._v(" "),i("td")]),e._v(" "),i("tr",[i("td",{attrs:{colspan:"2"}})]),e._v(" "),i("tr",[i("th",{attrs:{colspan:"2"}},[e._v("Re: visualisation")])]),e._v(" "),i("tr",[i("td",[e._v("Name:")]),e._v(" "),i("td",[e._v("Prof Sean O'Donoghue")])]),e._v(" "),i("tr",[i("td",[e._v("Position:")]),e._v(" "),i("td",[e._v("Team Leader, Data61")])]),e._v(" "),i("tr",[i("td",[e._v("Email:")]),e._v(" "),i("td")])])])],1)],1)],1)],1)],1)},staticRenderFns:[]},ce=i("VU/8")(null,he,!1,null,null,null).exports,de=i("0jyg"),ve={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{height:"85%"}},[i("v-container",{attrs:{"grid-list-xl":""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{sm8:""}},[i("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],attrs:{combobox:"",label:"Query",items:e.querySelectItems,filter:e.customFilter,"error-messages":e.errors.collect("query"),hint:"Space separated list of search terms. eg oxygen 1000:1200","persistent-hint":"","data-vv-name":"query",loading:e.isWorking,"item-text":"text","item-value":"value","return-object":"","search-input":e.search},on:{"update:searchInput":function(t){e.search=t}},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1),e._v(" "),i("v-flex",{attrs:{sm2:""}},[i("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"length:4",expression:"'length:4'"}],attrs:{label:"PDB",items:e.pdbSelectItems,"error-messages":e.errors.collect("pdb"),"data-vv-name":"pdb","cache-items":"",required:""},model:{value:e.pdb,callback:function(t){e.pdb=t},expression:"pdb"}})],1),e._v(" "),i("v-flex",{attrs:{sm2:""}},[i("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"isValidEnergyCutOffSet",expression:"'isValidEnergyCutOffSet'"}],attrs:{combobox:"","cache-items":"",label:"Energy Cutoff Set",items:e.localEnergyCutoffSets,"error-messages":e.errors.collect("energyCutoffSet"),"data-vv-name":"energyCutoffSet"},model:{value:e.energyCutoffSet,callback:function(t){e.energyCutoffSet=t},expression:"energyCutoffSet"}})],1)],1)],1),e._v(" "),i("v-layout",{staticStyle:{height:"100%"},attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs12:""}},[i("div",{staticStyle:{height:"100%"},attrs:{id:"jolecule"}})])],1)],1)},staticRenderFns:[]};var pe=function(e){i("uvxf")},fe=i("VU/8")(de.a,ve,!1,pe,"data-v-1a6e2fbc",null).exports;o.a.use(L.a);var me,ge=new L.a({routes:[{path:"/",name:"home",component:ce},{path:"/login",name:"login",component:N},{path:"/register",name:"register",component:H},{path:"/edit-user",name:"editUser",component:Y},{path:"/admin-users",name:"adminUsers",component:q},{path:"/reset-password/:tokenId",name:"resetPassword",component:J},{path:"/Search",name:"search",component:le},{path:"/View",name:"view",component:fe}]}),we=(me=a()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=3;break}return e.next=3,D.restoreLastUser();case 3:return e.abrupt("return",new o.a({el:"#app",router:ge,store:T.a,template:"<App/>",components:{App:B}}));case 4:case"end":return e.stop()}},e,this)})),function(){return me.apply(this,arguments)});o.a.config.productionTip=!1,o.a.use(l.a),document.title=c,we()},WQOK:function(e,t){},a9sO:function(e,t){},bei4:function(e,t,i){"use strict";i("mvHQ");var s=i("BO1k"),r=i.n(s),n=25;function a(){if(requestAnimationFrame(a),window.globalWidgets!==[]){var e=(new Date).getTime(),t=(e-window.lastTime)/n;t<1&&(t=1),t=Math.floor(t);for(var i=0;i<t;i++){var s=!0,o=!1,u=void 0;try{for(var l,h=r()(window.globalWidgets);!(s=(l=h.next()).done);s=!0){l.value.animate()}}catch(e){o=!0,u=e}finally{try{!s&&h.return&&h.return()}finally{if(o)throw u}}}var c=!0,d=!1,v=void 0;try{for(var p,f=r()(window.globalWidgets);!(c=(p=f.next()).done);c=!0){var m=p.value;m.isChanged()&&m.draw()}}catch(e){d=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw v}}window.lastTime=e}}function o(e){void 0===window.globalWidgets&&(window.globalWidgets=[],a(),window.lastTime=(new Date).getTime()),window.globalWidgets.push(e)}var u=i("Xxa5"),l=i.n(u),h=i("//Fk"),c=i.n(h),d=i("exGp"),v=i.n(d),p=i("Zrlr"),f=i.n(p),m=i("wxAW"),g=i.n(m),w=i("7t+N"),y=i.n(w),_=i("M4fF"),b=i.n(_),x=i("d7EF"),k=i.n(x),C=i("RRo+"),S=i.n(C),V=i("w6Vy"),P=1e-6;function A(e){return Math.abs(e)<P}function T(e,t,i){return new V.Vector3(e,t,i)}function R(e,t){var i=T(e.x,e.y,e.z);return i.multiplyScalar(t),i}function D(e,t){return T(e.x-t.x,e.y-t.y,e.z-t.z)}function E(e,t){return T(t.x+e.x,t.y+e.y,t.z+e.z)}function M(e,t){var i=t.length(),s=void 0;A(i)?s=T(e.x,e.y,e.z):s=R(t,B(e,t)/i/i);return s}function O(e,t){return D(e,M(e,t))}function I(e,t){return(new V.Vector3).crossVectors(e,t)}function B(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function L(e,t){var i=e.length(),s=t.length();if(A(i*s))return 0;var r=B(e,t)/i/s;return r>=1?0:r<-1?Math.PI:Math.acos(r)}var z=V.Matrix4;var U={SMALL:P,isNearZero:A,create:T,clone:function(e){return e.clone()},scaled:R,normalized:function(e){return R(e,1/e.length())},diff:D,sum:E,parallel:M,perpendicular:O,crossProduct:I,dotProduct:B,distance:function(e,t){return D(e,t).length()},angle:L,dihedral:function(e,t,i){var s=O(e,t),r=O(i,t),n=L(s,r);return B(I(s,r),t)>0&&(n=-n),n},midPoint:function(e,t){return R(E(e,t),.5)},random:function(){return T(Math.random(),Math.random(),Math.random())},isEqual:function(e,t){return!!A(e.x-t.x)&&!!A(e.y-t.y)&&!!A(e.y-t.y)},isAligned:function(e,t){return A(L(e,t))},Matrix4:z,matrixProduct:function(e,t){var i=new z;return i.multiplyMatrices(e,t),i},rotation:function(e,t){var i=e.clone().normalize();return(new z).makeRotationAxis(i,t)},translation:function(e){return(new z).makeTranslation(e.x,e.y,e.z)},degToRad:function(e){return e*Math.PI/180}};function N(e){return!b.a.isUndefined(e)&&null!==e}function F(){return""+window.location}function W(e,t,i,s){var r=y()("<a>").attr("id",e).attr("href","").html(t);return i&&r.addClass(i),s&&r.on(" click touch ",function(e){e.preventDefault(),s()}),r}function H(e,t,i,s,r,n){var a=y()("<a>").attr("id",e).attr("href","").html(t);function o(){s()?n?a.css("background-color",n):a.addClass("jolecule-button-toggle-on"):n?a.css("background-color",""):a.removeClass("jolecule-button-toggle-on")}return i&&a.addClass(i),a.click(function(e){return e.preventDefault(),r(!s()),o(),!1}),a.redraw=o,o(),a}function G(e,t){return t.indexOf(e)>=0}function j(){return"view:"+function(e){for(var t="0123456789abcdefghiklmnopqrstuvwxyz",i="",s=0;s<e;s++){var r=Math.floor(Math.random()*t.length);i+=t.substring(r,r+1)}return i}(6)}function Y(e){return new c.a(function(t){setTimeout(t,e)})}var K=i("Zx67"),Q=i.n(K),q=i("zwoO"),$=i.n(q),X=i("Pf15"),J=i.n(X);function Z(e,t,i,s,r){var n=.5*(s-t),a=.5*(r-i),o=e*e;return(2*i-2*s+n+a)*(e*o)+(-3*i+3*s-2*n-a)*o+n*e+i}function ee(e,t,i,s,r){return U.create(Z(e,t.x,i.x,s.x,r.x),Z(e,t.y,i.y,s.y,r.y),Z(e,t.z,i.z,s.z,r.z))}var te=function(){function e(){f()(this,e),this.points=[],this.normals=[],this.tangents=[],this.binormals=[]}return g()(e,[{key:"slice",value:function(t,i){var s=new e;return s.points=this.points.slice(t,i),s.normals=this.normals.slice(t,i),s.tangents=this.tangents.slice(t,i),s.binormals=this.binormals.slice(t,i),s}}]),e}(),ie=function(e){function t(e,i,s,r,n){f()(this,t);var a=$()(this,(t.__proto__||Q()(t)).call(this));if(a.type="RibbonGeometry",a.parameters={shape:e,path:i,round:s},i.points.length<2)return $()(a);var o=e.extractPoints(4).shape,u=o.length;b.a.isUndefined(s)&&(s=!1);var l=[];if(!s)for(var h=0;h<u;h+=1){var c=h-1;-1===c&&(c=u-1);var d=o[c],v=o[h],p=-(v.y-d.y),m=v.x-d.x;l.push(new V.Vector2(p,m))}for(var g=0;g<i.points.length;g+=1){for(var w=i.points[g],y=i.normals[g],_=i.binormals[g],x=0;x<u;x+=1){var k=o[x],C=y.clone().multiplyScalar(k.x),S=_.clone().multiplyScalar(k.y),P=w.clone().add(C).add(S);a.vertices.push(P)}var A=a.vertices.length-2*u;if(!(A<0))if(s)for(var T=0;T<u;T+=1){var R=void 0,D=A+(R=0===T?u-1:T-1),E=A+T,M=void 0,O=void 0;M=i.normals[g-1].clone().multiplyScalar(o[R].x),O=i.binormals[g-1].clone().multiplyScalar(o[R].y);var I=M.add(O);M=i.normals[g-1].clone().multiplyScalar(o[T].x),O=i.binormals[g-1].clone().multiplyScalar(o[T].y);var B=M.add(O);M=i.normals[g].clone().multiplyScalar(o[T].x),O=i.binormals[g].clone().multiplyScalar(o[T].y);var L=M.add(O);M=i.normals[g].clone().multiplyScalar(o[R].x),O=i.binormals[g].clone().multiplyScalar(o[R].y);var z=M.add(O),U=new V.Face3(D,D+u,E+u);U.vertexNormals=[I,z,L],a.faces.push(U),(U=new V.Face3(D,E+u,E)).vertexNormals=[I,L,B],a.faces.push(U)}else for(var N=0;N<u;N+=1){var F=A+(0===N?u-1:N-1),W=A+N,H=void 0,G=void 0;H=i.normals[g-1].clone().multiplyScalar(l[N].x),G=i.binormals[g-1].clone().multiplyScalar(l[N].y);var j=H.add(G);H=i.normals[g].clone().multiplyScalar(l[N].x),G=i.binormals[g].clone().multiplyScalar(l[N].y);var Y=H.add(G),K=new V.Face3(F,F+u,W+u);K.vertexNormals=[j,Y,Y],a.faces.push(K),(K=new V.Face3(F,W+u,W)).vertexNormals=[j,Y,j],a.faces.push(K)}}if(r)for(var q=ce([a.vertices[0],a.vertices[1],a.vertices[2]]),X=0;X<u-2;X+=1){var J=new V.Face3(X,X+1,u-1);J.normal.copy(q),a.faces.push(J)}if(n)for(var Z=a.vertices.length-1-u,ee=ce([a.vertices[Z],a.vertices[Z+u-1],a.vertices[Z+1]]),te=0;te<u-2;te+=1){var ie=new V.Face3(Z+te,Z+u-1,Z+te+1);ie.normal.copy(ee),a.faces.push(ie)}return a}return J()(t,e),t}(V.Geometry),se=function(e){function t(e,i,s,n,a){f()(this,t);var o=$()(this,(t.__proto__||Q()(t)).call(this));o.type="BufferRibbonGeometry",b.a.isUndefined(s)&&(s=!1),o.parameters={shape:i,traces:e,round:s,front:n,back:a},o.shapePoints=i.extractPoints(4).shape,o.nShape=o.shapePoints.length,o.nVertex=0,o.nFace=0,o.countVertexAndFacesOfPath(n,a),o.setAttributes();var u=!0,l=!1,h=void 0;try{for(var c,d=r()(b.a.range(o.paths.length));!(u=(c=d.next()).done);u=!0){var v=c.value;o.setPath(v,n,a)}}catch(e){l=!0,h=e}finally{try{!u&&d.return&&d.return()}finally{if(l)throw h}}return console.log("BufferRibbonGeometry vertices",o.nVertex,o.positionCount/3),console.log("BufferRibbonGeometry faces",o.nFace,o.indexCount/3),console.log("BufferRibbonGeometry attributes",o.attributes),o}return J()(t,e),g()(t,[{key:"setPath",value:function(e,t,i){var s=this.paths[e],n=this.parameters.traces[e];console.log(n.points.length,n.detail,s.points.length,2*n.points.length*n.detail);for(var a=[],o=void 0,u=void 0,l=0;l<n.points.length;l+=1){var h=2*l*n.detail-n.detail;h<0&&(h=0);var c=2*(l+1)*n.detail-n.detail;c>=s.points.length&&(c=s.points.length),o=n.getReference(l).color;for(var d=h;d<c;d+=1)if(!(d in a)){if(u=o,d===h){var v=n.getReference(l-1).color;v===o||b.a.isUndefined(v)||(console.log("half color",l,d,v,o),(u=o.clone()).lerp(v,.5))}a[d]=this.vertexCount;var p=8,f=.5;"C"===n.getReference(l).ss&&(p=1,f=1);var m=s.points[d],g=s.normals[d],w=s.binormals[d],y=!0,_=!1,x=void 0;try{for(var k,C=r()(this.shapePoints);!(y=(k=C.next()).done);y=!0){var S=k.value,P=g.clone().multiplyScalar(S.x*p),A=w.clone().multiplyScalar(S.y*f);this.pushVertex(m.clone().add(P).add(A),u)}}catch(e){_=!0,x=e}finally{try{!y&&C.return&&C.return()}finally{if(_)throw x}}}}for(var T=[],R=0;R<this.nShape;R+=1){var D=R-1;-1===D&&(D=this.nShape-1);var E=this.shapePoints[D],M=this.shapePoints[R],O=-(.5*M.y-.5*E.y),I=8*M.x-8*E.x;T.push(new V.Vector2(O,I))}for(var B=s.points.length,L=1;L<B;L+=1)for(var z=a[L-1],U=0;U<this.nShape;U+=1){var N=void 0;N=0===U?this.nShape-1:U-1;var F=void 0,W=void 0;if(this.parameters.round){F=s.normals[L-1].clone().multiplyScalar(this.shapePoints[N].x),W=s.binormals[L-1].clone().multiplyScalar(this.shapePoints[N].y);var H=F.add(W);F=s.normals[L-1].clone().multiplyScalar(this.shapePoints[U].x),W=s.binormals[L-1].clone().multiplyScalar(this.shapePoints[U].y);var G=F.add(W);F=s.normals[L].clone().multiplyScalar(this.shapePoints[U].x),W=s.binormals[L].clone().multiplyScalar(this.shapePoints[U].y);var j=F.add(W);F=s.normals[L].clone().multiplyScalar(this.shapePoints[N].x),W=s.binormals[L].clone().multiplyScalar(this.shapePoints[N].y);var Y=F.add(W),K=z+N,Q=z+U,q=K+this.nShape,$=Q+this.nShape;this.pushFace(K,q,$,H,Y,j),this.pushFace(K,$,Q,H,j,G)}else{F=s.normals[L-1].clone().multiplyScalar(T[N].x),W=s.binormals[L-1].clone().multiplyScalar(T[N].y);var X=F.add(W);F=s.normals[L].clone().multiplyScalar(T[U].x),W=s.binormals[L].clone().multiplyScalar(T[U].y);var J=F.add(W),Z=z+N,ee=z+U,te=Z+this.nShape,ie=ee+this.nShape;this.pushFace(ie,Z,te,J,X,J),this.pushFace(ee,Z,ie,X,X,J)}}}},{key:"setAttributes",value:function(){var e=new Float32Array(3*this.nVertex),t=new Float32Array(3*this.nVertex),i=new Int32Array(3*this.nFace),s=new Float32Array(3*this.nVertex);this.addAttribute("position",new V.Float32BufferAttribute(e,3)),this.addAttribute("normal",new V.Float32BufferAttribute(t,3)),this.addAttribute("color",new V.Float32BufferAttribute(s,3)),this.setIndex(new V.Uint32BufferAttribute(i,1)),this.positions=this.attributes.position.array,this.normals=this.attributes.normal.array,this.indices=this.index.array,this.colors=this.attributes.color.array,this.positionCount=0,this.indexCount=0,this.vertexCount=0}},{key:"pushVertex",value:function(e,t){this.positions[this.positionCount]=e.x,this.positions[this.positionCount+1]=e.y,this.positions[this.positionCount+2]=e.z,this.colors[this.positionCount]=t.r,this.colors[this.positionCount+1]=t.g,this.colors[this.positionCount+2]=t.b,this.positionCount+=3,this.vertexCount+=1}},{key:"pushFace",value:function(e,t,i,s,r,n){this.indices[this.indexCount]=e,this.indices[this.indexCount+1]=t,this.indices[this.indexCount+2]=i,this.indexCount+=3,this.normals[3*e]=s.x,this.normals[3*e+1]=s.y,this.normals[3*e+2]=s.z,this.normals[3*t]=r.x,this.normals[3*t+1]=r.y,this.normals[3*t+2]=r.z,this.normals[3*i]=n.x,this.normals[3*i+1]=n.y,this.normals[3*i+2]=n.z}},{key:"getVertex",value:function(e){return U.create(this.positions[3*e],this.positions[3*e+1],this.positions[3*e+2])}},{key:"countVertexAndFacesOfPath",value:function(e,t){this.nVertex=0,this.nFace=0,this.paths=[];var i=!0,s=!1,n=void 0;try{for(var a,o=r()(this.parameters.traces);!(i=(a=o.next()).done);i=!0){var u=a.value,l=u.detailedPath;this.paths.push(l);var h=l.points.length;this.nVertex+=h*this.nShape;var c=u.points.length;this.nFace+=2*(c-1)*this.nShape*(2*u.detail+1)}}catch(e){s=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw n}}}}]),t}(V.BufferGeometry);var re=function(e){function t(){f()(this,t);var e=$()(this,(t.__proto__||Q()(t)).call(this));return e.indices=[],e.detail=2,e}return J()(t,e),g()(t,[{key:"getReference",value:function(e){var t=this.indices[e];return this.referenceObjects[t]}},{key:"calcTangents",value:function(){var e=this.points.length,t=e-1;if(e-0>2){this.tangents[0]=this.points[1].clone().sub(this.points[0]).normalize();for(var i=1;i<t;i+=1)this.tangents[i]=this.points[i+1].clone().sub(this.points[i-1]).normalize();this.tangents[t]=this.points[t].clone().sub(this.points[t-1]).normalize()}else{var s=this.points[t].clone().sub(this.points[0]).normalize();this.tangents[0]=s,this.tangents[t]=s}}},{key:"calcNormals",value:function(){var e=this.points.length,t=e-1;if(e-0>2){for(var i=1;i<t;i+=1)if(null!==this.normals[i])this.normals[i]=he(this.tangents[i],this.normals[i]),this.normals[i].normalize();else{var s=this.points[i].clone().sub(this.points[i-1]);this.normals[i]=U.create().crossVectors(s,this.tangents[i]).normalize();var r=this.normals[i-1];null!==r&&this.normals[i].dot(r)<0&&this.normals[i].negate()}this.normals[0]=this.normals[1],this.normals[t]=this.normals[t-1]}else for(var n=0;n<=t;n+=1)if(null!==this.normals[n])this.normals[n]=he(this.tangents[n],this.normals[n]),this.normals[n].normalize();else{var a=this.points[n];this.normals[n]=U.create().crossVectors(a,this.tangents[n]).normalize()}}},{key:"calcBinormals",value:function(){for(var e=this.points.length,t=0;t<e;t+=1)this.binormals[t]=U.create().crossVectors(this.tangents[t],this.normals[t])}},{key:"expand",value:function(){this.detailedPath=function(e,t,i,s){var r=new te;r.points.push(e.points[i]);for(var n=i;n<s-1;n+=1)for(var a=t+1,o=1;o<a;o+=1){var u=o/t,l=void 0,h=void 0;l=n>0?e.points[n-1]:e.points[n].clone().sub(e.tangents[n]),h=n<e.points.length-2?e.points[n+2]:e.points[n+1].clone().add(e.tangents[n]),r.points.push(ee(u,l,e.points[n],e.points[n+1],h))}r.normals.push(e.normals[i]);for(var c=i;c<s-1;c+=1)for(var d=1;d<t+1;d+=1){var v=d/t,p=void 0,f=void 0;p=c>0?e.normals[c-1]:e.normals[c],f=c<e.normals.length-2?e.normals[c+2]:e.normals[c+1],r.normals.push(ee(v,p,e.normals[c],e.normals[c+1],f).normalize())}for(var m=0;m<r.points.length;m+=1)0===m?r.tangents.push(e.tangents[0]):m===r.points.length-1?r.tangents.push(e.tangents[s-1]):r.tangents.push(r.points[m+1].clone().sub(r.points[m-1]).normalize());for(var g=0;g<r.points.length;g+=1)r.binormals.push(U.create().crossVectors(r.tangents[g],r.normals[g]));return r}(this,2*this.detail,0,this.points.length)}},{key:"getSegmentGeometry",value:function(e,t,i,s,r,n){var a=this.detailedPath,o=2*e*this.detail-this.detail;o<0&&(o=0);var u=2*(e+1)*this.detail-this.detail+1;u>=a.points.length&&(u=a.points.length-1);var l=a.slice(o,u),h=new ie(t,l,i,s,r);return pe(h,n),h}},{key:"getGeometry",value:function(e,t,i,s,r){var n=this.detailedPath,a=this.points.length,o=0*this.detail-this.detail;o<0&&(o=0);var u=2*a*this.detail-this.detail+1;u>=n.points.length&&(u=n.points.length-1);var l=n.slice(o,u);return new se(this,l,t,i,s,r)}}]),t}(te),ne=function(e){function t(){f()(this,t);var e=new V.Shape([new V.Vector2(-.4,-.5),new V.Vector2(0,.5),new V.Vector2(.4,-.5)]),i=new V.CatmullRomCurve3([U.create(0,-.3,0),U.create(0,.3,0)]),s=$()(this,(t.__proto__||Q()(t)).call(this,e,{steps:2,bevelEnabled:!1,extrudePath:i}));return s.type="BlockArrowGeometry",s.applyMatrix((new V.Matrix4).makeRotationFromEuler(new V.Euler(0,Math.PI/2,0))),s}return J()(t,e),t}(V.ExtrudeGeometry),ae=function(e){function t(){f()(this,t);var e=$()(this,(t.__proto__||Q()(t)).call(this,1,1,1,4,1,!1));return e.type="UnitCylinderGeometry",e.applyMatrix((new V.Matrix4).makeRotationFromEuler(new V.Euler(Math.PI/2,Math.PI,0))),e}return J()(t,e),t}(V.CylinderGeometry),oe=function(e){function t(e,i){f()(this,t);var s=$()(this,(t.__proto__||Q()(t)).call(this));s.type="RaisedShapeGeometry",s.parameters={vertices:e,thickness:i};for(var r=ce(e.slice(0,3)).clone().multiplyScalar(i/2),n=e.length,a=n-1,o=n,u=0;u<e.length;u+=1)s.vertices.push(e[u].clone().add(r));for(var l=0;l<e.length;l+=1)s.vertices.push(e[l].clone().sub(r));for(var h=0;h<n-2;h+=1){var c=new V.Face3(h,h+1,a);s.faces.push(c)}for(var d=0;d<n-2;d+=1){var v=new V.Face3(o+d,o+a,o+d+1);s.faces.push(v)}for(var p=0;p<n;p+=1){var m=void 0;m=p===n-1?0:p+1,s.faces.push(new V.Face3(p,p+o,m+o)),s.faces.push(new V.Face3(p,m+o,m))}return s.computeFaceNormals(),s}return J()(t,e),t}(V.Geometry);function ue(e,t){b.a.isUndefined(e)||e.traverse(function(e){e.visible=t})}function le(e){for(var t=e.children.length-1;t>=0;t-=1){var i=e.children[t];b.a.isUndefined(i.dontDelete)&&(b.a.isUndefined(i.geometry)||i.geometry.dispose(),b.a.isUndefined(i.material)||i.material.dispose(),e.remove(i))}}function he(e,t){var i=e.clone().multiplyScalar(t.dot(e));return t.clone().sub(i)}function ce(e){var t=new V.Vector3,i=new V.Vector3;return t.subVectors(e[2],e[1]),i.subVectors(e[0],e[1]),t.cross(i),t.normalize(),t}function de(e,t){return(new V.Quaternion).setFromUnitVectors(e,t)}function ve(e,t,i){return i*(t-e)+e}function pe(e,t){for(var i=0;i<e.faces.length;i+=1){var s=e.faces[i];s.vertexColors[0]=t,s.vertexColors[1]=t,s.vertexColors[2]=t}}function fe(e,t,i){var s=new V.Object3D;return s.scale.set(i,i,e.distanceTo(t)),s.position.copy(e).add(t).multiplyScalar(.5),s.lookAt(t),s.updateMatrix(),s.matrix}function me(e,t){for(var i=e.length,s=new Float32Array(i*t),r=0;r<t;r+=1)for(var n=r*i,a=0;a<i;a+=1)s[n+a]=e[a];return s}var ge=function(e){function t(e,i){f()(this,t);var s=$()(this,(t.__proto__||Q()(t)).call(this));s.type="CopyBufferGeometry",s.parameters={nCopy:i},s.refBufferGeometry=e;var r=me(e.attributes.position.array,i);s.addAttribute("position",new V.Float32BufferAttribute(r,3));var n=me(e.attributes.normal.array,i);s.addAttribute("normal",new V.Float32BufferAttribute(n,3));var a=me(e.attributes.uv.array,i);s.addAttribute("uv",new V.Float32BufferAttribute(a,2));var o=e.attributes.position.count;if("index"in e&&e.index){var u=function(e,t,i){for(var s=e.length,r=new Uint32Array(s*t),n=0;n<t;n+=1)for(var a=n*s,o=n*i,u=0;u<s;u+=1)r[a+u]=e[u]+o;return r}(e.index.array,i,o);s.setIndex(new V.Uint32BufferAttribute(u,1))}var l=new Float32Array(3*o*i);return s.addAttribute("color",new V.Float32BufferAttribute(l,3)),s}return J()(t,e),g()(t,[{key:"applyMatrixToCopy",value:function(e,t){var i=this.refBufferGeometry.attributes.position.array.length,s=this.attributes.position.array,r=this.attributes.normal.array,n=t*i,a=n+i;!function(e,t,i,s){for(var r=e.elements,n=i;n<s;n+=3){var a=t[n],o=t[n+1],u=t[n+2];t[n]=r[0]*a+r[4]*o+r[8]*u+r[12],t[n+1]=r[1]*a+r[5]*o+r[9]*u+r[13],t[n+2]=r[2]*a+r[6]*o+r[10]*u+r[14]}}(e,s,n,a),function(e,t,i,s){for(var r=e.elements,n=i;n<s;n+=3){var a=t[n],o=t[n+1],u=t[n+2];t[n]=r[0]*a+r[4]*o+r[8]*u,t[n+1]=r[1]*a+r[5]*o+r[9]*u,t[n+2]=r[2]*a+r[6]*o+r[10]*u}}(e,r,n,a)}},{key:"applyColorToCopy",value:function(e,t){var i=this.refBufferGeometry.attributes.position.array.length,s=t*i;!function(e,t,i,s){for(var r=i;r<s;r+=3)t[r]=e.r,t[r+1]=e.g,t[r+2]=e.b}(e,this.attributes.color.array,s,s+i)}}]),t}(V.BufferGeometry),we=function(){function e(t){f()(this,e),console.log("SpaceHash assigning vertices to cells"),this.vertices=t,this.padding=.05,this.div=5,this.invDiv=1/this.div,this.maxima=[0,0,0],this.minima=[0,0,0],this.spans=[0,0,0],this.sizes=[0,0,0];for(var i=0;i<3;i++){for(var s=0;s<this.vertices.length;s+=1)this.minima[i]>this.vertices[s][i]&&(this.minima[i]=this.vertices[s][i]),this.maxima[i]<this.vertices[s][i]&&(this.maxima[i]=this.vertices[s][i]);this.minima[i]-=this.padding,this.maxima[i]+=this.padding,this.spans[i]=this.maxima[i]-this.minima[i],this.sizes[i]=Math.ceil(this.spans[i]*this.invDiv)}this.cells={},this.spaces=[];for(var r=0;r<this.vertices.length;r++){var n=this.vertices[r],a=this.getSpaceFromVertex(n);this.spaces.push(a);var o=this.getHashFromSpace(a);o in this.cells||(this.cells[o]=[]),this.cells[o].push(r)}}return g()(e,[{key:"getSpaceFromVertex",value:function(e){for(var t=[],i=0;i<3;i++)t.push(Math.round((e[i]-this.minima[i])*this.invDiv));return t}},{key:"getHashFromSpace",value:function(e){return e[0]*this.sizes[1]*this.sizes[2]+e[1]*this.sizes[2]+e[2]}},{key:"pushCellOfSpace",value:function(e,t,i){for(var s=this.getSpaceFromVertex(t),r=Math.max(0,s[0]-1),n=Math.min(this.sizes[0],s[0]+2),a=Math.max(0,s[1]-1),o=Math.min(this.sizes[1],s[1]+2),u=Math.max(0,s[2]-1),l=Math.min(this.sizes[2],s[2]+2),h=r;h<n;h++)for(var c=a;c<o;c++)for(var d=u;d<l;d++){var v=this.getHashFromSpace([h,c,d]);if(v in this.cells)for(var p=this.cells[v],f=0;f<p.length;f++){var m=p[f];e.push([i,m])}}}},{key:"getClosePairs",value:function(){console.log("SpatialHash.getClosePairs");for(var e=[],t=0;t<this.vertices.length;t++)this.pushCellOfSpace(e,this.vertices[t],t);return e}},{key:"getVerticesNearPoint",value:function(e,t){console.log("SpatialHash.getClosePairs");var i=[];return this.pushCellOfSpace(i,e,t),i}}]),e}(),ye=i("Gu7T"),_e=i.n(ye);var be=function(){function e(t,i){f()(this,e),this.length=0,this.count=0,this._fields=t,S()(i)?this._init(i):this._init(0)}return g()(e,[{key:"_init",value:function(e){this.length=e,this.count=0;var t=!0,i=!1,s=void 0;try{for(var n,a=r()(this._fields);!(t=(n=a.next()).done);t=!0){var o=n.value;this._initField.apply(this,_e()(o))}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}}},{key:"_initField",value:function(e,t,i){this[e]=function(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}(i,this.length*t)}},{key:"addField",value:function(e,t,i){this._fields.push([e,t,i]),this._initField(e,t,i)}},{key:"resize",value:function(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(var t=0,i=this._fields.length;t<i;++t){var s=this._fields[t][0],r=this._fields[t][1],n=this.length*r,a=new this[s].constructor(n);this[s].length>n?a.set(this[s].subarray(0,n)):a.set(this[s]),this[s]=a}}},{key:"growIfFull",value:function(){if(this.count>=this.length){var e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}},{key:"increment",value:function(){this.count+=1,this.growIfFull()}},{key:"copyFrom",value:function(e,t,i,s){for(var r=0,n=this._fields.length;r<n;++r)for(var a=this._fields[r][0],o=this._fields[r][1],u=this[a],l=e[a],h=0;h<s;++h)for(var c=o*(t+h),d=o*(i+h),v=0;v<o;++v)u[c+v]=l[d+v]}},{key:"copyWithin",value:function(e,t,i){for(var s=0,r=this._fields.length;s<r;++s)for(var n=this._fields[s][0],a=this._fields[s][1],o=this[n],u=0;u<i;++u)for(var l=a*(e+u),h=a*(t+u),c=0;c<a;++c)o[l+c]=o[h+c]}},{key:"sort",value:function(e){var t=this,i=new this.constructor(this._fields,1);!function s(r,n){if(r<n){var a=Math.floor((r+n)/2),o=r,u=n;do{for(;e(o,a)<0;)o+=1;for(;e(u,a)>0;)u-=1;o<=u&&(o===a?a=u:u===a&&(a=o),(l=o)!==(h=u)&&(i.copyFrom(t,0,l,1),t.copyWithin(l,h,1),t.copyFrom(i,h,0,1)),o+=1,u-=1)}while(o<=u);s(r,u),s(o,n)}var l,h}(0,this.count-1)}},{key:"clear",value:function(){this.count=0}},{key:"dispose",value:function(){delete this.length,delete this.count;for(var e=0,t=this._fields.length;e<t;++e){delete this[this._fields[e][0]]}}}]),e}(),xe=i("OvRC"),ke=i.n(xe);function Ce(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}var Se=function(){function e(t,i){f()(this,e),this.length=t,this._words=new Uint32Array(t+32>>>5),!0===i&&this.setAll()}return g()(e,[{key:"get",value:function(e){return 0!=(this._words[e>>>5]&1<<e)}},{key:"set",value:function(e){this._words[e>>>5]|=1<<e}},{key:"clear",value:function(e){this._words[e>>>5]&=~(1<<e)}},{key:"flip",value:function(e){this._words[e>>>5]^=1<<e}},{key:"_assignRange",value:function(e,t,i){for(var s=this._words,r=!0===i?4294967295:0,n=e>>>5,a=t>>>5,o=n;o<a;++o)s[o]=r;var u=n<<5,l=a<<5;if(!0===i)if(t-e<32)for(var h=e,c=t+1;h<c;++h)s[h>>>5]|=1<<h;else{for(var d=e,v=u;d<v;++d)s[d>>>5]|=1<<d;for(var p=l,f=t+1;p<f;++p)s[p>>>5]|=1<<p}else if(t-e<32)for(var m=e,g=t+1;m<g;++m)s[m>>>5]&=~(1<<m);else{for(var w=e,y=u;w<y;++w)s[w>>>5]&=~(1<<w);for(var _=l,b=t+1;_<b;++_)s[_>>>5]&=~(1<<_)}return this}},{key:"setRange",value:function(e,t){return this._assignRange(e,t,!0)}},{key:"clearRange",value:function(e,t){return this._assignRange(e,t,!1)}},{key:"setBits",value:function(){for(var e=this._words,t=arguments.length,i=0;i<t;++i){var s=arguments[i];e[s>>>5]|=1<<s}return this}},{key:"clearBits",value:function(){for(var e=this._words,t=arguments.length,i=0;i<t;++i){var s=arguments[i];e[s>>>5]&=~(1<<s)}return this}},{key:"setAll",value:function(){return this._assignRange(0,this.length-1,!0)}},{key:"clearAll",value:function(){return this._assignRange(0,this.length-1,!1)}},{key:"flipAll",value:function(){for(var e=this._words.length,t=this._words,i=32-this.length%32,s=0;s<e-1;++s)t[s]=~t[s];return t[e-1]=~(t[e-1]<<i)>>>i,this}},{key:"_isRangeValue",value:function(e,t,i){for(var s=this._words,r=!0===i?4294967295:0,n=e>>>5,a=t>>>5,o=n;o<a;++o)if(s[o]!==r)return!1;if(t-e<32){for(var u=e,l=t+1;u<l;++u)if(!!(s[u>>>5]&1<<u)!==i)return!1}else{for(var h=a<<5,c=e,d=n<<5<<5;c<d;++c)if(!!(s[c>>>5]&1<<c)!==i)return!1;for(var v=h,p=t+1;v<p;++v)if(!!(s[v>>>5]&1<<v)!==i)return!1}return!0}},{key:"isRangeSet",value:function(e,t){return this._isRangeValue(e,t,!0)}},{key:"isRangeClear",value:function(e,t){return this._isRangeValue(e,t,!1)}},{key:"isAllSet",value:function(){return this._isRangeValue(0,this.length-1,!0)}},{key:"isAllClear",value:function(){return this._isRangeValue(0,this.length-1,!1)}},{key:"isSet",value:function(){for(var e=this._words,t=arguments.length,i=0;i<t;++i){var s=arguments[i];if(0==(e[s>>>5]&1<<s))return!1}return!0}},{key:"isClear",value:function(){for(var e=this._words,t=arguments.length,i=0;i<t;++i){var s=arguments[i];if(0!=(e[s>>>5]&1<<s))return!1}return!0}},{key:"isEqualTo",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0;r<s;++r)if(t[r]!==i[r])return!1;return!0}},{key:"getSize",value:function(){for(var e=this._words.length,t=this._words,i=0,s=0;s<e;++s)i+=Ce(t[s]);return i}},{key:"difference",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0;r<s;++r)t[r]=t[r]&~i[r];for(var n=t.length;n<s;++n)t[n]=0;return this}},{key:"union",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0;r<s;++r)t[r]|=i[r];for(var n=t.length;n<s;++n)t[n]=0;return this}},{key:"intersection",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0;r<s;++r)t[r]&=i[r];for(var n=t.length;n<s;++n)t[n]=0;return this}},{key:"intersects",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0;r<s;++r)if(0!=(t[r]&i[r]))return!0;return!1}},{key:"getIntersectionSize",value:function(e){for(var t=this._words,i=e._words,s=Math.min(t.length,i.length),r=0,n=0;n<s;++n)r+=Ce(t[n]&i[n]);return r}},{key:"makeIntersection",value:function(t){var i=this._words,s=t._words,r=Math.min(i.length,s.length),n=new Uint32Array(r),a=ke()(e.prototype);a._words=n,a.length=Math.min(this.length,t.length);for(var o=0;o<r;++o)n[o]=i[o]&s[o];return a}},{key:"forEach",value:function(e){for(var t=this._words.length,i=this._words,s=0,r=0;r<t;++r)for(var n=i[r];0!==n;){var a=n&-n;e((r<<5)+Ce(a-1),s),n^=a,++s}}},{key:"toArray",value:function(){for(var e=this._words,t=new Array(this.getSize()),i=this._words.length,s=0,r=0;r<i;++r)for(var n=e[r];0!==n;){var a=n&-n;t[s++]=(r<<5)+Ce(a-1),n^=a}return t}},{key:"toString",value:function(){return"{"+this.toArray().join(",")+"}"}},{key:"toSeleString",value:function(){var e=this.toArray().join(",");return e?"@"+e:"NONE"}},{key:"clone",value:function(){var t=ke()(e.prototype);return t.length=this.length,t._words=new Uint32Array(this._words),t}}]),e}(),Ve=["ALA","CYS","ASP","GLU","PHE","GLY","HIS","ILE","LYS","LEU","MET","ASN","PRO","GLN","ARG","SER","THR","TRP","VAL","TYR"],Pe=["DA","DT","DG","DC","A","T","G","C"],Ae=["RA","RU","RC","RG","A","G","C","U"],Te=new V.Color(6527297),Re=new V.Color(5671605),De=new V.Color(16763136),Ee=new V.Color(9795754),Me=new V.Color(12303291),Oe=new V.Color(10040115),Ie=new V.Color(3032862),Be=new V.Color(4220806),Le=new V.Color(12818688),ze=new V.Color(6179947),Ue=new V.Color(5592405),Ne=new V.Color(6693410),Fe={H:13421772,C:11184810,O:13369344,N:204,S:11184640,P:6693580,F:52224,CL:52224,BR:8921600,I:6684842,FE:13395456,CA:8947882,He:8095426,Ne:10408676,Ar:6145214,Kr:11326326,Xe:16228220,Rn:14851781},We=!0,He=!1,Ge=void 0;try{for(var je,Ye=r()(b.a.toPairs(Fe));!(We=(je=Ye.next()).done);We=!0){var Ke=je.value,Qe=k()(Ke,2),qe=Qe[0],$e=Qe[1];Fe[qe]=new V.Color($e)}}catch(e){He=!0,Ge=e}finally{try{!We&&Ye.return&&Ye.return()}finally{if(He)throw Ge}}function Xe(e){return(new V.Color).setHex(e)}function Je(e){return"E"===e?De:"H"===e?Re:"D"===e?Ee:"C"===e?Te:"W"===e?Oe:Me}var Ze={ALA:"A",CYS:"C",ASP:"D",GLU:"E",PHE:"F",GLY:"G",HIS:"H",ILE:"I",LYS:"K",LEU:"L",MET:"M",ASN:"N",PRO:"P",GLN:"Q",ARG:"R",SER:"S",THR:"T",VAL:"V",TRP:"W",TYR:"Y",DA:"A",DT:"T",DG:"G",DC:"C",A:"A",T:"T",G:"G",C:"C",RA:"A",RU:"U",RC:"C",RG:"G",U:"U"},et=["N","C","O","H","HA","CA","OXT","C3'","P","OP1","O5'","OP2","C5'","O5'","O3'","C4'","O4'","C1'","C2'","O2'","H2'","H2''","H3'","H4'","H5'","H5''","HO3'"],tt=new V.Shape([new V.Vector2(-1.5,-.2),new V.Vector2(-1.5,.2),new V.Vector2(1.5,.2),new V.Vector2(1.5,-.2)]),it=new V.Shape([new V.Vector2(-.2,-.2),new V.Vector2(-.2,.2),new V.Vector2(.2,.2),new V.Vector2(.2,-.2)]);new V.Shape([new V.Vector2(-.25,-.25),new V.Vector2(-.25,.25),new V.Vector2(.25,.25),new V.Vector2(.25,-.25)]);function st(e){return e.replace(/\d+/,"")}function rt(e,t,i){t in e||(e[t]=[]),e[t].push(i)}function nt(e,t){return b.a.includes(e,t)||e.push(t),e.indexOf(t)}function at(e){return e?String.fromCharCode(e):""}function ot(e){return e.charCodeAt(0)}var ut=[["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["bfactor",1,"float32"],["alt",1,"uint8"],["iAtomType",1,"uint16"],["iElem",1,"uint16"],["iRes",1,"uint32"],["iChain",1,"int32"],["bondOffset",1,"uint32"],["bondCount",1,"uint16"]],lt=function(){function e(t,i){f()(this,e),this.soup=t,S()(i)&&this.load(i),this._pos=U.create()}return g()(e,[{key:"load",value:function(e){return this.iAtom=e,this}},{key:"getBondIndices",value:function(){var e=this.soup.atomStore.bondOffset[this.iAtom],t=e+this.soup.atomStore.bondCount[this.iAtom];return b.a.range(e,t)}},{key:"pos",get:function(){return this._pos.x=this.soup.atomStore.x[this.iAtom],this._pos.y=this.soup.atomStore.y[this.iAtom],this._pos.z=this.soup.atomStore.z[this.iAtom],this._pos}},{key:"resId",get:function(){return this.soup.resIds[this.iRes]}},{key:"elem",get:function(){var e=this.soup.atomStore.iElem[this.iAtom];return this.soup.elemTable[e]}},{key:"bfactor",get:function(){return this.soup.atomStore.bfactor[this.iAtom]}},{key:"atomType",get:function(){var e=this.soup.atomStore.iAtomType[this.iAtom];return this.soup.atomTypeTable[e]}},{key:"alt",get:function(){return at(this.soup.atomStore.alt[this.iAtom])},set:function(e){this.soup.atomStore.alt[this.iAtom]=ot(e)}},{key:"iRes",get:function(){return this.soup.atomStore.iRes[this.iAtom]}},{key:"resType",get:function(){var e=this.soup.residueStore[this.iRes];return this.soup.resTypeTable[e]}},{key:"label",get:function(){var e=this.soup.residueStore.iResType[this.iRes],t=this.soup.resTypeTable[e],i=this.soup.resIds[this.iRes]+":"+t+":"+this.atomType;return this.alt&&(i+=":"+this.alt),i}},{key:"color",get:function(){if("C"===this.elem||"H"===this.elem){var e=this.iRes,t=this.soup.residueStore.iColor[e];return this.soup.colorTable[t]}return this.elem in Fe?Fe[this.elem]:Ue}}]),e}(),ht=[["atomOffset",1,"uint32"],["atomCount",1,"uint16"],["iCentralAtom",1,"uint32"],["iResType",1,"uint16"],["iChain",1,"uint8"],["resNum",1,"int32"],["insCode",1,"uint8"],["sstruc",1,"uint8"],["iColor",1,"uint8"],["isPolymer",1,"uint8"]],ct=function(){function e(t,i){f()(this,e),this.soup=t,S()(i)&&this.load(i)}return g()(e,[{key:"load",value:function(e){return this.iRes=e,this}},{key:"getAtomIndices",value:function(){var e=this.soup.residueStore.atomOffset[this.iRes],t=e+this.soup.residueStore.atomCount[this.iRes];return b.a.range(e,t)}},{key:"getAtomProxy",value:function(e){var t=this.soup.getAtomProxy(),i=!0,s=!1,n=void 0;try{for(var a,o=r()(this.getAtomIndices());!(i=(a=o.next()).done);i=!0){var u=a.value;if(t.iAtom=u,t.atomType===e)return t}}catch(e){s=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw n}}return null}},{key:"getIAtom",value:function(e){var t=!0,i=!1,s=void 0;try{for(var n,a=r()(this.getAtomIndices());!(t=(n=a.next()).done);t=!0){var o=n.value,u=this.soup.atomStore.iAtomType[o];if(this.soup.atomTypeTable[u]===e)return o}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}return null}},{key:"checkAtomTypes",value:function(e){var t=!0,i=!1,s=void 0;try{for(var n,a=r()(e);!(t=(n=a.next()).done);t=!0){var o=n.value;if(null===this.getIAtom(o))return!1}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}return!0}},{key:"isProteinConnectedToPrev",value:function(){if(0===this.iRes)return!1;var t=new e(this.soup,this.iRes-1),i=["CA","N","C"];if(t.checkAtomTypes(i)&&this.checkAtomTypes(i)){var s=t.getAtomProxy("C").pos,r=this.getAtomProxy("N").pos;if(U.distance(s,r)<2)return!0}return!1}},{key:"isNucleotideConnectedToPrev",value:function(){if(0===this.iRes)return!1;var t=new e(this.soup,this.iRes-1),i=["C3'","O3'","C5'","O4'","C1'"];if(t.checkAtomTypes(i)&&this.checkAtomTypes(i)&&this.checkAtomTypes(["P"])){var s=t.getAtomProxy("O3'").pos,r=this.getAtomProxy("P").pos;if(U.distance(s,r)<2.5)return!0}return!1}},{key:"isConnectedToPrev",value:function(){return this.isProteinConnectedToPrev()||this.isNucleotideConnectedToPrev()}},{key:"getNucleotideNormal",value:function(){var e=this.getAtomProxy("C3'").pos,t=this.getAtomProxy("C5'").pos,i=this.getAtomProxy("C1'").pos,s=U.diff(e,t),r=U.diff(i,e);return U.crossProduct(s,r)}},{key:"iAtom",get:function(){return this.soup.residueStore.iCentralAtom[this.iRes]},set:function(e){this.soup.residueStore.iCentralAtom[this.iRes]=e}},{key:"iChain",get:function(){return this.soup.residueStore.iChain[this.iRes]}},{key:"resId",get:function(){return this.soup.resIds[this.iRes]}},{key:"resNum",get:function(){return this.soup.residueStore.resNum[this.iRes]}},{key:"insCode",get:function(){return at(this.soup.residueStore.insCode[this.iRes])},set:function(e){this.soup.residueStore.insCode[this.iRes]=ot(e)}},{key:"isPolymer",get:function(){return 1===this.soup.residueStore.isPolymer[this.iRes]},set:function(e){this.soup.residueStore.isPolymer[this.iRes]=e?1:0}},{key:"color",get:function(){var e=this.soup.residueStore.iColor[this.iRes];return this.soup.colorTable[e]},set:function(e){var t=nt(this.soup.colorTable,e);this.soup.residueStore.iColor[this.iRes]=t}},{key:"selected",get:function(){return this.soup.residueSelect.get(this.iRes)},set:function(e){e?this.soup.residueSelect.set(this.iRes):this.soup.residueSelect.clear(this.iRes)}},{key:"resType",get:function(){var e=this.soup.residueStore.iResType[this.iRes];return this.soup.resTypeTable[e]}},{key:"normal",get:function(){return this.iRes in this.soup.residueNormal?this.soup.residueNormal[this.iRes].clone():null}},{key:"ss",get:function(){return at(this.soup.residueStore.sstruc[this.iRes])},set:function(e){this.soup.residueStore.sstruc[this.iRes]=ot(e)}},{key:"label",get:function(){var e=this.soup.residueStore.iResType[this.iRes],t=this.soup.resTypeTable[e];return this.soup.resIds[this.iRes]+":"+t}}]),e}(),dt=[["iAtom1",1,"int32"],["iAtom2",1,"int32"]],vt=function(){function e(t,i){f()(this,e),this.soup=t,S()(i)&&this.load(i)}return g()(e,[{key:"load",value:function(e){return this.iBond=e,this}},{key:"iAtom1",get:function(){return this.soup.bondStore.iAtom1[this.iBond]}},{key:"iAtom2",get:function(){return this.soup.bondStore.iAtom2[this.iBond]}}]),e}(),pt=function(){function e(){f()(this,e),this.parsingError="",this.title="",this.chains=[],this.atomStore=new be(ut),this.residueStore=new be(ht),this.bondStore=new be(dt),this.resIds=[],this.residueNormal={},this.residueProxy=new ct(this),this.atomProxy=new lt(this),this.atomSelect=new Se(0),this.residueSelect=new Se(0),this.bondSelect=new Se(0),this.elemTable=[],this.atomTypeTable=[],this.resTypeTable=[],this.colorTable=[],this.grid={bCutoff:.8,bMax:2,bMin:.4,changed:!0,isElem:{}}}return g()(e,[{key:"load",value:function(e){console.log("Soup.load parse "+this.pdbId+"..."),this.parsePdbData(e.pdb_text,this.pdbId),this.assignResidueSsAndCentralAtoms(),console.log("Soup.load processed "+this.getAtomCount()+" atoms, "+this.getResidueCount()+" residues"),console.log("Soup.load finding bonds..."),this.calcBondsStrategic(),console.log("Soup.load calculated "+this.getBondCount()+" bonds"),this.calcMaxLength(),this.findSecondaryStructure(),console.log("Soup.load calculated secondary-structure")}},{key:"parsePdbData",value:function(e,t){if(this.pdbId||(this.pdbId=t,console.log("Set pdbId",this.pdbId)),!this.title){var i=function(e){var t="",i=e.split(/\r?\n/),s=!0,n=!1,a=void 0;try{for(var o,u=r()(i);!(s=(o=u.next()).done);s=!0){var l=o.value;"TITLE"===l.substring(0,5)&&(t+=l.substring(10))}}catch(e){n=!0,a=e}finally{try{!s&&u.return&&u.return()}finally{if(n)throw a}}return t}(e);this.title=this.pdbId+": "+i}var s=e.split(/\r?\n/),n=[],a=!0,o=!1,u=void 0;try{for(var l,h=r()(s);!(a=(l=h.next()).done);a=!0){var c=l.value;if("ATOM"!==c.slice(0,4)&&"HETATM"!==c.slice(0,6)||n.push(c),"END"===c.slice(0,3))break}}catch(e){o=!0,u=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw u}}if(0!==n.length)for(var d=void 0,v=void 0,p=void 0,f=void 0,m=void 0,g=void 0,w=void 0,y=void 0,_=void 0,x=void 0,k=void 0,C=0;C<n.length;C+=1){var S=n[C];if("ATOM"===S.substr(0,4)||"HETATM"===S.substr(0,6)){try{g=b.a.trim(S.substr(12,4)),_=b.a.trim(S.substr(16,1)),m=b.a.trim(S.substr(17,3)),f=b.a.trim(S[21]),x=parseInt(S.substr(22,4)),k=S.substr(26,1),d=parseFloat(S.substr(30,7)),v=parseFloat(S.substr(38,7)),p=parseFloat(S.substr(46,7)),w=parseFloat(S.substr(60,6)),y=st(b.a.trim(S.substr(76,2)))}catch(e){this.parsingError="line "+C,console.log('Error: "'+S+'"');continue}""===y&&(y=st(b.a.trim(g)).substr(0,1)),this.addAtom(d,v,p,w,_,g,y,m,x,k,f)}}else this.parsingError="No atom lines"}},{key:"addAtom",value:function(e,t,i,s,r,n,a,o,u,l,h){var c=this.atomStore.count;this.atomStore.increment(),this.atomStore.x[c]=e,this.atomStore.y[c]=t,this.atomStore.z[c]=i,this.atomStore.bfactor[c]=s,this.atomStore.alt[c]=ot(r),this.atomStore.bondCount[c]=0,this.atomStore.iAtomType[c]=nt(this.atomTypeTable,n),this.atomStore.iElem[c]=nt(this.elemTable,a);var d=this.getResidueCount(),v=!1;0===d?v=!0:(this.residueProxy.iRes=d-1,this.residueProxy.resNum!==u?v=!0:this.residueProxy.insCode!==l&&(v=!0)),v&&this.addResidue(c,u,l,h,o);var p=this.getResidueCount()-1;this.residueStore.atomCount[p]+=1,this.atomStore.iRes[c]=p}},{key:"addResidue",value:function(e,t,i,s,r){var n=this.getResidueCount();this.residueStore.increment();var a=this.pdbId+":";s&&(a+=s+":"),a+=t+b.a.trim(i),this.resIds.push(a);var o=nt(this.chains,s);this.residueStore.iChain[n]=o,this.residueStore.resNum[n]=t,this.residueStore.insCode[n]=ot(i),this.residueStore.iResType[n]=nt(this.resTypeTable,r),this.residueStore.atomOffset[n]=e,this.residueStore.atomCount[n]=0}},{key:"getAtomProxyOfCenter",value:function(){var e=b.a.range(this.getAtomCount()),t=this.getCenter(e),i=this.getIAtomClosest(t,e);return this.getAtomProxy(i)}},{key:"assignResidueSsAndCentralAtoms",value:function(){for(var e=this.getResidueProxy(),t=0;t<this.getResidueCount();t+=1)if(e.iRes=t,b.a.includes(Ve,e.resType))e.iAtom=e.getIAtom("CA"),e.ss="C",e.isPolymer=!0;else if(b.a.includes(Pe,e.resType)||b.a.includes(Ae,e.resType))e.iAtom=e.getIAtom("C3'"),e.ss="D",e.isPolymer=!0;else{e.isPolymer=!1,"HOH"===e.resType?e.ss="W":"XXX"===e.resType?e.ss="G":e.ss="-";var i=this.getCenter(e.getAtomIndices());e.iAtom=this.getIAtomClosest(i,e.getAtomIndices())}this.atomSelect=new Se(this.getAtomCount()),this.residueSelect=new Se(this.getResidueCount())}},{key:"getIAtomClosest",value:function(e,t){var i=null,s=1e6,n=this.getAtomProxy(),a=!0,o=!1,u=void 0;try{for(var l,h=r()(t);!(a=(l=h.next()).done);a=!0){var c=l.value;if(null===i)i=c;else{n.iAtom=c;var d=U.distance(e,n.pos);d<s&&(i=c,s=d)}}}catch(e){o=!0,u=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw u}}return i}},{key:"getCenter",value:function(e){var t=U.create(0,0,0),i=this.getAtomProxy(),s=!0,n=!1,a=void 0;try{for(var o,u=r()(e);!(s=(o=u.next()).done);s=!0){var l=o.value;t=U.sum(t,i.load(l).pos)}}catch(e){n=!0,a=e}finally{try{!s&&u.return&&u.return()}finally{if(n)throw a}}return t.divideScalar(e.length),t}},{key:"calcMaxLength",value:function(){var e=[0,0,0],t=[0,0,0],i=[0,0,0];function s(e,t){return 0===t?e.x:1===t?e.y:2===t?e.z:void 0}for(var r=this.getAtomProxy(),n=0;n<3;n++){for(var a=0;a<this.getAtomCount();a+=1){var o=r.load(a).pos;t[n]>s(o,n)&&(t[n]=s(o,n)),e[n]<s(o,n)&&(e[n]=s(o,n))}i[n]=e[n]-t[n]}this.maxLength=Math.max(i[0],i[1],i[2])}},{key:"calcBondsStrategic",value:function(){var e=this;this.bondStore.count=0;var t=1.44,i=3.61,s=5.76,n=["C","H","O","N","P","S"];function a(e,r){if(null===e||null===r)return!1;if(""!==e.alt&&""!==r.alt&&e.alt!==r.alt)return!1;var a=void 0;a="H"===e.elem||"H"===r.elem?t:G(e.elem,n)&&G(r.elem,n)?i:s;var o=e.pos.x-r.pos.x,u=e.pos.y-r.pos.y,l=e.pos.z-r.pos.z;return o*o+u*u+l*l<=a}for(var o=function(t,i){var s=e.getBondCount();e.bondStore.increment(),e.bondStore.iAtom1[s]=t.iAtom,e.bondStore.iAtom2[s]=i.iAtom,s=e.getBondCount(),e.bondStore.increment(),e.bondStore.iAtom1[s]=i.iAtom,e.bondStore.iAtom2[s]=t.iAtom},u=this.getResidueProxy(),l=this.getResidueProxy(),h=this.getResidueCount(),c=this.getAtomProxy(),d=this.getAtomProxy(),v=0;v<h;v++){l.iRes=v;var p=!0,f=!1,m=void 0;try{for(var g,w=r()(l.getAtomIndices());!(p=(g=w.next()).done);p=!0){var y=g.value,_=!0,b=!1,x=void 0;try{for(var k,C=r()(l.getAtomIndices());!(_=(k=C.next()).done);_=!0){var S=k.value;c.iAtom=y,d.iAtom=S,a(c,d)&&o(c,d)}}catch(e){b=!0,x=e}finally{try{!_&&C.return&&C.return()}finally{if(b)throw x}}}}catch(e){f=!0,m=e}finally{try{!p&&w.return&&w.return()}finally{if(f)throw m}}}for(var V=1;V<h;V++){if(u.iRes=V-1,l.iRes=V,l.isProteinConnectedToPrev())c.iAtom=u.getIAtom("C"),d.iAtom=l.getIAtom("N");else{if(!l.isNucleotideConnectedToPrev())continue;c.iAtom=u.getIAtom("O3'"),d.iAtom=l.getIAtom("P")}o(c,d)}var P=this.bondStore.iAtom1;this.bondStore.sort(function(e,t){return P[e]-P[t]});for(var A=0;A<this.getAtomCount();A+=1)this.atomStore.bondCount[A]=0;for(var T=this.getBondProxy(),R=null,D=0;D<this.getBondCount();D+=1)T.iBond=D,R!==T.iAtom1&&(R=T.iAtom1,this.atomStore.bondOffset[R]=D),this.atomStore.bondCount[R]+=1;this.bondSelect=new Se(this.getBondCount())}},{key:"findBackboneHbonds",value:function(){for(var e=this.getResidueProxy(),t=this.getAtomProxy(),i=this.getAtomProxy(),s=[],n=[],a=0;a<this.getResidueCount();a+=1)if(e.iRes=a,e.isPolymer)for(var o=["O","N"],u=0;u<o.length;u++){var l=o[u],h=e.getIAtom(l);null!==h&&(t.iAtom=h,s.push([t.pos.x,t.pos.y,t.pos.z]),n.push(h))}var c=[],d=new we(s),v=!0,p=!1,f=void 0;try{for(var m,g=r()(d.getClosePairs());!(v=(m=g.next()).done);v=!0){var w=m.value;if(t.iAtom=n[w[0]],i.iAtom=n[w[1]],"O"===t.elem&&"N"===i.elem){var y=[i,t];t=y[0],i=y[1]}if("N"===t.elem&&"O"===i.elem){var _=t.iRes,b=i.iRes;_!==b&&U.distance(t.pos,i.pos)<=3.5&&rt(c,_,b)}}}catch(e){p=!0,f=e}finally{try{!v&&g.return&&g.return()}finally{if(p)throw f}}this.conhPartners=c}},{key:"findSecondaryStructure",value:function(){var e=this.conhPartners,t={},i=this.getResidueCount(),s=this.getResidueProxy(),n=this.getResidueProxy(),a=this.getAtomProxy(),o=this.getAtomProxy();function u(t,s){return!(s<0||s>=i||t<0||t>=i)&&b.a.includes(e[s],t)}function l(e,t){return a.iAtom=s.load(e).iAtom,o.iAtom=n.load(t).iAtom,U.diff(a.pos,o.pos)}for(var h=[],c=[],d=[],v=0;v<this.getResidueCount();v+=1)if(s.iRes=v,s.isPolymer&&"D"!==s.ss){var p=s.getIAtom("CA");null!==p&&(a.iAtom=p,h.push([a.pos.x,a.pos.y,a.pos.z]),c.push(p),d.push(v))}for(var f=0;f<i;f+=1)if(s.iRes=f,s.isPolymer)if("D"!==s.ss){if(u(f,f+4)&&u(f+1,f+5))for(var m=l(f,f+4),g=l(f+1,f+5),w=f+1;w<f+5;w+=1)s.load(w).ss="H",rt(t,w,m),rt(t,w,g);if(u(f,f+3)&&u(f+1,f+4))for(var y=l(f,f+3),_=l(f+1,f+4),x=f+1;x<f+4;x+=1)s.load(x).ss="H",rt(t,x,y),rt(t,x,_)}else rt(t,f,s.getNucleotideNormal());var C=[],S=new we(h),V=!0,P=!1,A=void 0;try{for(var T,R=r()(S.getClosePairs());!(V=(T=R.next()).done);V=!0){var D=T.value,E=k()(D,2),M=E[0],O=E[1],I=d[M],B=d[O];if(!(Math.abs(I-B)<=5)){if(u(I,B+1)&&u(B-1,I)&&(C=C.concat([I,B])),u(I-1,B)&&u(B,I+1)&&(C=C.concat([I,B])),u(I,B)&&u(B,I)){C=C.concat([I,B]);var L=l(I,B);rt(t,I,L),rt(t,B,U.scaled(L,-1))}if(u(I-1,B+1)&&u(B-1,I+1)){C=C.concat([I,B]);var z=l(I,B);rt(t,I,U.scaled(z,-1)),rt(t,B,z)}}}}catch(e){P=!0,A=e}finally{try{!V&&R.return&&R.return()}finally{if(P)throw A}}var N=!0,F=!1,W=void 0;try{for(var H,G=r()(C);!(N=(H=G.next()).done);N=!0){var j=H.value;s.load(j).ss="E"}}catch(e){F=!0,W=e}finally{try{!N&&G.return&&G.return()}finally{if(F)throw W}}for(var Y=0;Y<i;Y+=1)if(Y in t&&t[Y].length>0){var K=U.create(0,0,0),Q=!0,q=!1,$=void 0;try{for(var X,J=r()(t[Y]);!(Q=(X=J.next()).done);Q=!0){var Z=X.value;K=U.sum(K,Z)}}catch(e){q=!0,$=e}finally{try{!Q&&J.return&&J.return()}finally{if(q)throw $}}this.residueNormal[Y]=U.normalized(K)}for(var ee=1;ee<i;ee+=1)s.iRes=ee-1,n.iRes=ee,"E"===s.ss&&s.normal&&"E"===n.ss&&n.normal&&n.normal.dot(s.normal)<0&&this.residueNormal[ee].negate()}},{key:"getAtomProxy",value:function(e){return new lt(this,e)}},{key:"getAtomCount",value:function(){return this.atomStore.count}},{key:"getResidueProxy",value:function(e){return new ct(this,e)}},{key:"getCurrentResidueProxy",value:function(e){return this.residueProxy.load(e)}},{key:"getBondProxy",value:function(e){return new vt(this,e)}},{key:"getBondCount",value:function(){return this.bondStore.count}},{key:"getResidueCount",value:function(){return this.residueStore.count}},{key:"areCloseResidues",value:function(e,t){var i=this.getAtomProxy(),s=this.getAtomProxy(),n=this.getResidueProxy(e),a=i.load(n.iAtom).pos.clone(),o=n.getAtomIndices(),u=this.getResidueProxy(t),l=s.load(u.iAtom).pos.clone(),h=u.getAtomIndices();if(U.distance(a,l)>17)return!1;var c=!0,d=!1,v=void 0;try{for(var p,f=r()(o);!(c=(p=f.next()).done);c=!0){var m=p.value,g=!0,w=!1,y=void 0;try{for(var _,b=r()(h);!(g=(_=b.next()).done);g=!0){var x=_.value;if(U.distance(i.load(m).pos,s.load(x).pos)<4)return!0}}catch(e){w=!0,y=e}finally{try{!g&&b.return&&b.return()}finally{if(w)throw y}}}}catch(e){d=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw v}}return!1}},{key:"clearSelectedResidues",value:function(){this.residueSelect.clearBits()}},{key:"selectResidues",value:function(e,t){var i=this.getResidueProxy(),s=!0,n=!1,a=void 0;try{for(var o,u=r()(e);!(s=(o=u.next()).done);s=!0){var l=o.value;i.load(l).selected=t}}catch(e){n=!0,a=e}finally{try{!s&&u.return&&u.return()}finally{if(n)throw a}}}},{key:"selectNeighbourResidues",value:function(e,t){for(var i=[e],s=0;s<this.getResidueCount();s+=1)this.areCloseResidues(s,e)&&i.push(s);this.selectResidues(i,t)}},{key:"findGridLimits",value:function(){for(var e=this.getResidueProxy(),t=this.getAtomProxy(),i=0;i<this.getResidueCount();i+=1)e.iRes=i,"G"===e.ss&&(t.iAtom=e.iAtom,t.elem in this.grid.isElem||(this.grid.isElem[t.elem]=!0),null===this.grid.bMin?(this.grid.bMin=t.bfactor,this.grid.bMax=t.bfactor):(t.bfactor>this.grid.bMax&&(this.grid.bMax=t.bfactor),t.bfactor<this.grid.bMin&&(this.grid.bMin=t.bfactor)));null===this.grid.bMin&&(this.grid.bMin=0),null===this.grid.bMax&&(this.grid.bMin=0),this.grid.bCutoff=this.grid.bMin}}]),e}(),ft=function(){function e(){f()(this,e),this.id="view:000000",this.iAtom=-1,this.order=1,this.cameraParams={focus:U.create(0,0,0),position:U.create(0,0,-1),up:U.create(0,1,0),zFront:0,zBack:0,zoom:1},this.selected=[],this.labels=[],this.distances=[],this.text="Default view of PDB file",this.creator="",this.url=F(),this.show={sidechain:!0,peptide:!0,hydrogen:!1,water:!1,ligands:!0,trace:!0,backboneAtom:!1,ribbon:!1}}return g()(e,[{key:"setCamera",value:function(e){this.cameraParams=e}},{key:"makeDefaultOfSoup",value:function(e){var t=e.getAtomProxyOfCenter();this.iAtom=t.iAtom,this.show.sidechain=!1,this.cameraParams.zFront=-e.maxLength/2,this.cameraParams.zBack=e.maxLength/2,this.cameraParams.zoom=1.75*Math.abs(e.maxLength),this.cameraParams.up=U.create(0,1,0),this.cameraParams.focus.copy(t.pos),this.cameraParams.position=U.create(0,0,-this.cameraParams.zoom).add(t.pos),this.order=0,this.text=e.title,this.pdb_id=e.pdbId}},{key:"getViewTranslatedTo",value:function(e){var t=this.clone(),i=e.clone().sub(t.cameraParams.focus);return t.cameraParams.focus.copy(e),t.cameraParams.position.add(i),t}},{key:"clone",value:function(){var t=new e;return t.id=this.id,t.iAtom=this.iAtom,t.selected=this.selected,t.labels=b.a.cloneDeep(this.labels),t.distances=b.a.cloneDeep(this.distances),t.order=this.order,t.text=this.text,t.time=this.time,t.url=this.url,t.cameraParams=b.a.cloneDeep(this.cameraParams),t.show=b.a.cloneDeep(this.show),t}},{key:"getDict",value:function(){var e=this.cameraParams.focus.clone().sub(this.cameraParams.position),t=e.length();e.normalize();var i=this.cameraParams.focus,s=i.clone().add(e),r=i.clone().sub(this.cameraParams.up),n=b.a.clone(this.show);return n.all_atom=n.backboneAtom,delete n.backboneAtom,{version:2,view_id:this.id,creator:this.creator,pdb_id:this.pdb_id,order:this.order,show:this.show,text:this.text,i_atom:this.iAtom,labels:this.labels,selected:this.selected,distances:this.distances,camera:{slab:{z_front:this.cameraParams.zFront,z_back:this.cameraParams.zBack,zoom:t},pos:[i.x,i.y,i.z],up:[r.x,r.y,r.z],in:[s.x,s.y,s.z]}}}},{key:"setFromDict",value:function(e){this.id=e.view_id,this.view_id=e.view_id,this.pdb_id=e.pdb_id,this.lock=e.lock,this.text=e.text,this.creator=e.creator,this.order=e.order,this.res_id=e.res_id,this.iAtom=e.i_atom,this.labels=e.labels,this.selected=e.selected,this.distances=e.distances,this.show=e.show,this.show.backboneAtom=e.show.all_atom,delete this.show.all_atom,this.show.backboneAtom||this.show.trace||this.show.ribbon||(this.show.ribbon=!0);var t=U.create(e.camera.pos[0],e.camera.pos[1],e.camera.pos[2]),i=U.create(e.camera.up[0],e.camera.up[1],e.camera.up[2]),s=U.create(e.camera.in[0],e.camera.in[1],e.camera.in[2]),r=e.camera.slab.zoom,n=U.clone(t),a=U.clone(s).sub(n).multiplyScalar(r).negate(),o=U.clone(n).add(a),u=U.clone(i).sub(n).negate();this.cameraParams={focus:n,position:o,up:u,zFront:e.camera.slab.z_front,zBack:e.camera.slab.z_back,zoom:r}}}]),e}();function mt(e,t,i){var s=e.position.clone().sub(e.focus),r=s.length();s.normalize();var n=t.position.clone().sub(t.focus),a=n.length();n.normalize();var o=de(s,n),u=function(e,t){return(new V.Quaternion).slerp(e,t)}(de(e.up.clone().applyQuaternion(o),t.up).multiply(o),i),l=t.focus.clone().sub(e.focus).multiplyScalar(i),h=e.focus.clone().add(l),c=ve(r,a,i),d=s.clone().applyQuaternion(u).multiplyScalar(c);return{focus:h,position:h.clone().add(d),up:e.up.clone().applyQuaternion(u),zFront:ve(e.zFront,t.zFront,i),zBack:ve(e.zBack,t.zBack,i),zoom:c}}var gt=function(){function e(t){f()(this,e),this.soup=t,this.changed=!0,this.currentView=new ft,this.savedViewsByViewId={},this.savedViews=[],this.iLastViewSelected=0,this.targetView=null,this.nUpdateStep=-1,this.maxUpdateStep=20,this.updateResidueSelection=!1,this.updateView=!0}return g()(e,[{key:"initViewsAfterSoupLoad",value:function(){0===this.savedViews.length&&(this.currentView.makeDefaultOfSoup(this.soup),this.saveView(this.currentView),this.changed=!0)}},{key:"setTargetView",value:function(e){this.nUpdateStep=this.maxUpdateStep,this.targetView=e.clone(),this.updateView=!0}},{key:"getCenteredAtom",value:function(){var e=this.currentView.iAtom;return this.soup.getAtomProxy(e)}},{key:"getIViewFromViewId",value:function(e){for(var t=0;t<this.savedViews.length;t+=1)if(this.savedViews[t].id===e)return t;return-1}},{key:"insertView",value:function(e,t,i){this.savedViewsByViewId[t]=i,e>=this.savedViews.length?this.savedViews.push(i):this.savedViews.splice(e,0,i),this.iLastViewSelected=e;for(var s=0;s<this.savedViews.length;s++)this.savedViews[s].order=s}},{key:"removeView",value:function(e){var t=this.getIViewFromViewId(e);if(!(t<0)){this.savedViews.splice(t,1),delete this.savedViewsByViewId[e];for(var i=0;i<this.savedViews.length;i++)this.savedViews[i].order=i;this.iLastViewSelected>=this.savedViews.length&&(this.iLastViewSelected=this.savedViews.length-1),this.changed=!0}}},{key:"saveView",value:function(e){this.savedViewsByViewId[e.id]=e,this.savedViews.push(e)}}]),e}(),wt=function(){function e(t){f()(this,e),this.soup=t.soup,this.soupView=t}return g()(e,[{key:"deleteDistance",value:function(e){this.soupView.currentView.distances.splice(e,1),this.soupView.changed=!0}},{key:"makeDistance",value:function(e,t){this.soupView.currentView.distances.push({i_atom1:e,i_atom2:t}),this.soupView.changed=!0}},{key:"makeAtomLabel",value:function(e,t){this.soupView.currentView.labels.push({i_atom:e,text:t}),this.soupView.changed=!0}},{key:"deleteAtomLabel",value:function(e){this.soupView.currentView.labels.splice(e,1),this.soupView.changed=!0}},{key:"setTargetView",value:function(e){this.soupView.setTargetView(e)}},{key:"setTargetViewByViewId",value:function(e){var t=this.soupView.savedViewsByViewId[e];this.soupView.iLastViewSelected=this.soupView.savedViewsByViewId[e].order,this.setTargetView(t)}},{key:"setTargetViewByAtom",value:function(e){var t=this.soup.getAtomProxy(e),i=this.soupView.currentView.getViewTranslatedTo(t.pos);i.iAtom=e,this.setTargetView(i)}},{key:"setTargetToPrevResidue",value:function(){var e=this.soupView.currentView.iAtom,t=this.soup.getAtomProxy(e).iRes;t<=0?t=this.soup.getResidueCount()-1:t-=1,e=this.soup.getResidueProxy(t).iAtom,this.setTargetViewByAtom(e)}},{key:"setTargetToNextResidue",value:function(){var e=this.soupView.currentView.iAtom,t=this.soup.getAtomProxy(e).iRes;t>=this.soup.getResidueCount()-1?t=0:t+=1,e=this.soup.getResidueProxy(t).iAtom,this.setTargetViewByAtom(e)}},{key:"setTargetToPrevView",value:function(){var e=this.soupView;e.iLastViewSelected-=1,e.iLastViewSelected<0&&(e.iLastViewSelected=e.savedViews.length-1);var t=e.savedViews[e.iLastViewSelected].id;return this.setTargetViewByViewId(t),t}},{key:"setTargetToNextView",value:function(){var e=this.soupView;e.iLastViewSelected+=1,e.iLastViewSelected>=e.savedViews.length&&(e.iLastViewSelected=0);var t=e.savedViews[e.iLastViewSelected].id;return this.setTargetViewByViewId(t),t}},{key:"swapViews",value:function(e,t){this.soupView.savedViews[t].order=e,this.soupView.savedViews[e].order=t;var i=this.soupView.savedViews[t];this.soupView.savedViews[t]=this.soupView.savedViews[e],this.soupView.savedViews[e]=i}},{key:"getViewDicts",value:function(){for(var e=[],t=1;t<this.soupView.savedViews.length;t+=1)e.push(this.soupView.savedViews[t].getDict());return e}},{key:"makeSelectedResidueList",value:function(){for(var e=[],t=this.soup.getResidueProxy(),i=0;i<this.soup.getResidueCount();i+=1)t.load(i).selected&&e.push(i);return e}},{key:"clearSelectedResidues",value:function(){this.soup.clearSelectedResidues(),this.soupView.currentView.selected=this.makeSelectedResidueList(),this.soupView.changed=!0}},{key:"selectResidue",value:function(e,t){this.soup.getResidueProxy(e).selected=t,this.soupView.currentView.selected=this.makeSelectedResidueList(),this.soupView.changed=!0}},{key:"toggleResidueNeighbors",value:function(){var e=this.soupView.currentView.iAtom,t=this.soup.getAtomProxy(e).iRes,i=void 0;this.lastNeighborIRes===t?(i=!1,this.lastNeighborIRes=null):(i=!0,this.lastNeighborIRes=t),this.soup.selectNeighbourResidues(t,i),this.soupView.currentView.selected=this.makeSelectedResidueList(),this.soupView.changed=!0,this.soupView.updateResidueSelection=!0}},{key:"saveCurrentView",value:function(e){var t=this.soupView.iLastViewSelected+1,i=this.soupView.currentView.clone();i.text="Click edit to change this text.",i.pdb_id=this.soup.pdb_id;var s,r,n=(s=new Date,r=s.getMonth()+1,s.getDate()+"/"+r+"/"+s.getFullYear());return i.creator="~ public @"+n,i.id=e,i.selected=this.makeSelectedResidueList(),this.soupView.insertView(t,e,i),t}},{key:"deleteView",value:function(e){this.soupView.removeView(e)}},{key:"sortViewsByOrder",value:function(){this.soupView.savedViews.sort(function(e,t){return e.order-t.order});for(var e=0;e<this.soupView.savedViews.length;e+=1)this.soupView.savedViews[e].order=e}},{key:"loadViewsFromViewDicts",value:function(e){for(var t=0;t<e.length;t+=1){var i=new ft;i.setFromDict(e[t]),"view:000000"!==i.id&&this.soupView.saveView(i)}this.sortViewsByOrder()}},{key:"setBackboneOption",value:function(e){this.soupView.currentView.show.backboneAtom=!1,this.soupView.currentView.show.trace=!1,this.soupView.currentView.show.ribbon=!1,this.soupView.currentView.show[e]=!0,this.soupView.changed=!0}},{key:"setShowOption",value:function(e,t){console.log("Controller.setShowOption",e,t),this.soupView.currentView.show[e]=t,"sidechain"===e&&(this.soupView.updateResidueSelection=!0),this.soupView.changed=!0}},{key:"getShowOption",value:function(e){return this.soupView.currentView.show[e]}},{key:"toggleShowOption",value:function(e){var t=this.getShowOption(e);this.setShowOption(e,!t)}},{key:"setChangeFlag",value:function(){this.soupView.changed=!0}},{key:"setCurrentView",value:function(e){this.soupView.currentView=e.clone(),this.soupView.soup.clearSelectedResidues(),this.soupView.soup.selectResidues(e.selected,!0),this.soupView.changed=!0}}]),e}(),yt=i("yEsh"),_t=i.n(yt),bt=function(){function e(t,i){f()(this,e),this.color=i,this.div=y()("<canvas>").css({position:"absolute","z-index":"1000",display:"none","pointer-events":"none"}),this.canvas=this.div[0],this.context2d=this.canvas.getContext("2d"),this.parentDiv=y()(t.divTag),this.parentDiv.append(this.div)}return g()(e,[{key:"hide",value:function(){this.div.css("display","none")}},{key:"move",value:function(e,t,i,s){var r=this.parentDiv.position(),n=Math.abs(e-i),a=Math.abs(t-s),o=Math.min(e,i),u=Math.min(t,s);this.div.css("display","block").css("width",n).css("height",a).css("top",u+r.top).css("left",o+r.left),this.canvas.width=n,this.canvas.height=a,this.context2d.clearRect(0,0,n,a),this.context2d.beginPath(),this.context2d.moveTo(e-o,t-u),this.context2d.lineTo(i-o,s-u),this.context2d.lineWidth=2,this.context2d.strokeStyle=this.color,this.context2d.stroke()}}]),e}(),xt=function(){function e(t){var i=this;f()(this,e),this.parentDiv=y()(t),this.div=y()("<div>").css("position","absolute").css("z-index",100),this.parentDiv.append(this.div),this.canvas=y()("<canvas>"),this.div.append(this.canvas),this.canvasDom=this.canvas[0],this.drawContext=this.canvasDom.getContext("2d"),this.mousePressed=!1;var s=this.canvasDom,r=function(e,t){s.addEventListener(e,t)};r("mousedown",function(e){return i.mousedown(e)}),r("mousemove",function(e){return i.mousemove(e)}),r("mouseup",function(e){return i.mouseup(e)}),r("mouseout",function(e){return i.mouseup(e)}),r("touchstart",function(e){return i.mousedown(e)}),r("touchmove",function(e){return i.mousemove(e)}),r("touchend",function(e){return i.mouseup(e)}),r("touchcancel",function(e){return i.mouseup(e)})}return g()(e,[{key:"width",value:function(){return this.parentDiv.width()}},{key:"height",value:function(){return this.parentDiv.height()}},{key:"x",value:function(){return this.parentDiv.position().left}},{key:"y",value:function(){return this.parentDiv.position().top}},{key:"inside",value:function(e,t){return e>=this.x()&&e<=this.x()+this.width()&&t>=this.y()&&t<=this.y()+this.height()}},{key:"draw",value:function(){}},{key:"resize",value:function(){this.canvasDom.width=this.width(),this.canvasDom.height=this.height()}},{key:"strokeRect",value:function(e,t,i,s,r){this.drawContext.strokeStyle=r,this.drawContext.strokeRect(e,t,i,s)}},{key:"fillRect",value:function(e,t,i,s,r){this.drawContext.fillStyle=r,this.drawContext.fillRect(e,t,i,s)}},{key:"line",value:function(e,t,i,s,r,n){this.drawContext.moveTo(e,t),this.drawContext.lineTo(i,s),this.drawContext.lineWidth=r,this.drawContext.strokeStyle=n,this.drawContext.stroke()}},{key:"text",value:function(e,t,i,s,r,n){this.drawContext.fillStyle=r,this.drawContext.font=s,this.drawContext.textAlign=n,this.drawContext.textBaseline="middle",this.drawContext.fillText(e,t,i)}},{key:"textWidth",value:function(e,t){return this.drawContext.font=t,this.drawContext.textAlign="center",this.drawContext.measureText(e).width}},{key:"mousedown",value:function(e){e.preventDefault(),this.mousePressed=!0,this.mousemove(e)}},{key:"mousemove",value:function(e){}},{key:"mouseup",value:function(e){e.preventDefault(),this.mousePressed=!1}},{key:"getPointer",value:function(e){var t=e.target.getBoundingClientRect();this.pointerX=e.clientX-t.left,this.pointerY=e.clientY-t.top}}]),e}(),kt=function(){function e(t){f()(this,e),this.div=y()("<div>").css({position:"absolute",top:0,left:0,background:"white",padding:"5",opacity:.7,display:"none","pointer-events":"none"}),this.arrow=y()("<div>").css({position:"absolute",top:0,left:0,width:0,height:0,"border-left":"5px solid transparent","border-right":"5px solid transparent","border-top":"50px solid white",opacity:.7,display:"none","pointer-events":"none"}),this.parentDiv=y()(t),this.parentDiv.append(this.div),this.parentDiv.append(this.arrow)}return g()(e,[{key:"move",value:function(e,t){var i=this.parentDiv.position(),s=this.div.innerWidth(),r=this.div.innerHeight();e<0||e>this.parentDiv.width()||t<0||t>this.parentDiv.height()?this.hide():(this.div.css({top:t-r-50+10+i.top,left:e-s/2+i.left,display:"block","font-family":"sans-serif",cursor:"pointer"}),this.arrow.css({top:t-50+i.top,left:e-5+i.left,display:"block"}))}},{key:"hide",value:function(){this.div.css("display","none"),this.arrow.css("display","none")}},{key:"html",value:function(e){this.div.html(e)}},{key:"remove",value:function(){this.div.remove(),this.arrow.remove()}}]),e}(),Ct=function(){function e(t){f()(this,e),this.display=t,this.soupView=t.soupView,this.controller=t.controller,this.popups=[]}return g()(e,[{key:"removePopup",value:function(e){this.popups[e].remove(),this.popups.splice(e,1),this.controller.deleteAtomLabel(e)}},{key:"createPopup",value:function(e){var t=this,i=new kt(this.display.divTag);return i.div.click(function(){t.removePopup(e)}),i}},{key:"draw",value:function(){var e=this.soupView.currentView.labels;if(e.length>this.popups.length)for(var t=this.popups.length;t<e.length;t+=1)this.popups.push(this.createPopup(t));if(this.popups.length>e.length)for(var i=this.popups.length-1;i>=e.length;i-=1)this.removePopup(i);for(var s=this.soupView.soup.getAtomProxy(),r=0;r<e.length;r+=1){s.iAtom=e[r].i_atom,this.popups[r].html(e[r].text);var n=.7*this.display.opacity(s.pos)+.2;this.popups[r].div.css("opacity",n),this.popups[r].arrow.css("opacity",n);var a=this.display.posXY(s.pos);this.popups[r].move(a.x,a.y),this.display.inZlab(s.pos)||(this.popups[r].div.css("display","none"),this.popups[r].arrow.css("display","none"))}}}]),e}(),St=function(){function e(t){f()(this,e),this.distanceMeasures=[],this.scene=t.displayScene,this.soupView=t.soupView,this.controller=t.controller,this.display=t,this.parentDiv=y()(this.display.divTag)}return g()(e,[{key:"removeDistance",value:function(e){this.scene.remove(this.distanceMeasures[e].line),this.distanceMeasures[e].div.remove(),this.controller.deleteDistance(e),this.distanceMeasures.splice(e,1)}},{key:"createDistanceMeasure",value:function(e){var t=this,i=y()("<div>").css({position:"absolute",top:0,left:0,"background-color":"#FFDDDD",padding:"5",opacity:.7,"font-family":"sans-serif"});i.click(function(){t.removeDistance(e)}),this.parentDiv.append(i);var s=new V.Geometry;s.vertices.push(new V.Vector3(0,0,0)),s.vertices.push(new V.Vector3(1,1,1));var r=new V.LineDashedMaterial({color:16742263,dashSize:3,gapSize:4,linewidth:2}),n=new V.Line(s,r);return this.scene.add(n),{line:n,div:i}}},{key:"draw",value:function(){var e=this.soupView.currentView.distances;if(e.length>this.distanceMeasures.length)for(var t=this.distanceMeasures.length;t<e.length;t+=1)this.distanceMeasures.push(this.createDistanceMeasure(t));if(this.distanceMeasures.length>e.length)for(var i=this.distanceMeasures.length-1;i>=e.length;i-=1)this.removeDistance(i);for(var s=this.parentDiv.position(),r=this.soupView.soup.getAtomProxy(),n=this.soupView.soup.getAtomProxy(),a=0;a<e.length;a+=1){var o=e[a],u=this.distanceMeasures[a],l=r.load(o.i_atom1).pos,h=n.load(o.i_atom2).pos,c=l.distanceTo(h).toFixed(1);u.div.text(c);var d=l.clone().add(h).multiplyScalar(.5),v=.7*this.display.opacity(d)+.3,p=this.display.posXY(d),f=p.x,m=p.y;if(f<0||f>this.parentDiv.width()||m<0||m>this.parentDiv.height())u.div.hide();else{var g=u.div.innerHeight(),w=u.div.innerWidth();u.div.css({top:m-g/2+s.top,left:f-w/2+s.left,display:"block",cursor:"pointer",opacity:v}),u.line.geometry.vertices[0].copy(l),u.line.geometry.vertices[1].copy(h),this.display.inZlab(d)||u.div.css("display","none")}}}}]),e}(),Vt=function(e){function t(e){f()(this,t);var i=$()(this,(t.__proto__||Q()(t)).call(this,e.divTag));return i.display=e,i.soupView=e.soupView,i.traces=e.traces,i.iRes=0,i.offsetY=4,i.heightBar=16,i.spacingY=4,i.backColor="#CCC",i.selectColor="#FFF",i.highlightColor="#222",i.div.attr("id","sequence-widget"),i.div.css({width:i.parentDiv.width(),height:i.height(),top:i.y(),"background-color":"#CCC","border-bottom":"1px solid #AAA"}),i.charWidth=14,i.charHeight=16,i.textXOffset=0,i.residues=[],i.iRes=null,i.iStartChar=null,i.iEndChar=null,i.resize(),i}return J()(t,e),g()(t,[{key:"width",value:function(){return this.parentDiv.width()}},{key:"height",value:function(){return this.offsetY+this.heightBar+6*this.spacingY+this.charHeight}},{key:"resize",value:function(){_t()(t.prototype.__proto__||Q()(t.prototype),"resize",this).call(this),this.div.css("width",this.parentDiv.width())}},{key:"xToI",value:function(e){return parseInt((e-this.textXOffset)*this.nResidue/this.textWidth())}},{key:"iToX",value:function(e){return parseInt(e/this.nResidue*this.textWidth())+this.textXOffset}},{key:"textWidth",value:function(){return this.width()-this.textXOffset}},{key:"xToIChar",value:function(e){return parseInt((e-this.textXOffset)*this.nChar/this.textWidth())+this.iStartChar}},{key:"iCharToX",value:function(e){return parseInt((e-this.iStartChar)/this.nChar*this.textWidth()+this.textXOffset)}},{key:"reset",value:function(){this.residues.length=0;var e=!0,t=!1,i=void 0;try{for(var s,n=r()(this.traces);!(e=(s=n.next()).done);e=!0){var a=s.value,o=!0,u=!1,l=void 0;try{for(var h,c=r()(b.a.range(a.points.length));!(o=(h=c.next()).done);o=!0){var d=h.value,v=a.indices[d],p=a.getReference(d),f={iRes:v,ss:p.ss,resId:p.resId,iAtom:p.iAtom},m=p.resType;f.c=m in Ze?Ze[m]:".",this.residues.push(f)}}catch(e){u=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}this.nResidue=this.residues.length,this.iRes=this.nChar/2,this.iStartChar=0}},{key:"draw",value:function(){if(N(this.soupView)&&0!==this.residues.length){this.nChar=Math.ceil(this.width()/this.charWidth),this.iEndChar=this.iStartChar+this.nChar,this.iEndChar>this.residues.length&&(this.iEndChar=this.residues.length),this.iStartChar<0&&(this.iStartChar=0),this.fillRect(0,0,this.width(),this.height(),this.backColor),this.fillRect(this.textXOffset,0,this.textWidth(),this.heightBar+2*this.spacingY,this.backColor),this.fillRect(this.textXOffset,this.offsetY+this.heightBar+2*this.spacingY,this.textWidth(),this.charHeight+2*this.spacingY,this.selectColor);var e=this.iToX(this.iStartChar),t=this.iToX(this.iEndChar);this.fillRect(e,this.offsetY,t-e,this.heightBar+2*this.spacingY,1,this.selectColor);for(var i=this.residues[0].ss,s=0,r=0;r<this.nResidue;)if((r+=1)===this.nResidue||this.residues[r].ss!==i){var n=this.iToX(s),a=this.iToX(r),o=Je(i).getStyle();this.fillRect(n,this.offsetY+this.spacingY,a-n,this.heightBar,o),r<=this.nResidue-1&&(s=r,i=this.residues[r].ss)}for(var u=this.offsetY+this.heightBar+3*this.spacingY,l=this.iStartChar;l<this.iEndChar;l+=1){var h=this.residues[l],c=this.iCharToX(l),d=Je(h.ss).getStyle();this.fillRect(c,u,this.charWidth,this.charHeight,d),this.text(h.c,c+this.charWidth/2,u+this.charHeight/2,"8pt Monospace","black","center")}for(var v=this.soupView.soup.getAtomProxy(this.soupView.currentView.iAtom),p=this.iStartChar;p<this.iEndChar;p++)if(p===v.iRes){this.strokeRect(this.iCharToX(p),this.offsetY+this.heightBar+2*this.spacingY,this.charWidth,this.charHeight+2*this.spacingY,this.highlightColor);break}}}},{key:"getCurrIAtom",value:function(){return this.residues[this.iRes].iAtom}},{key:"mousemove",value:function(e){this.mousePressed&&(this.getPointer(e),this.pointerY<this.heightBar+2*this.spacingY?(this.iRes=this.xToI(this.pointerX),this.iStartChar=Math.max(this.iRes-.5*this.nChar,0),this.iStartChar=Math.min(this.iStartChar,this.nResidue-this.nChar),this.iStartChar=parseInt(this.iStartChar),this.display.setTargetViewFromAtom(this.getCurrIAtom()),this.draw()):(this.iRes=this.xToIChar(this.pointerX),this.display.setTargetViewFromAtom(this.getCurrIAtom()),this.draw()))}}]),t}(xt),Pt=function(e){function t(e){f()(this,t);var i=$()(this,(t.__proto__||Q()(t)).call(this,e.divTag));return i.soupView=e.soupView,i.maxZLength=0,i.yOffset=60,i.div.attr("id","zslab"),i.backColor="rgb(150, 150, 150)",i.zBackColor="rgb(100, 70, 70)",i.zFrontColor="rgb(150, 90, 90)",i}return J()(t,e),g()(t,[{key:"resize",value:function(){this.div.css({width:this.width(),height:this.height(),top:this.y(),left:this.x()}),_t()(t.prototype.__proto__||Q()(t.prototype),"resize",this).call(this)}},{key:"width",value:function(){return 40}},{key:"y",value:function(){return this.parentDiv.position().top+this.yOffset}},{key:"height",value:function(){return this.parentDiv.height()-this.yOffset}},{key:"x",value:function(){var e=this.parentDiv.position();return this.parentDiv.width()-this.width()+e.left}},{key:"yToZ",value:function(e){return(.5-e/this.height())*this.maxZLength}},{key:"zToY",value:function(e){return(.5-e/this.maxZLength)*this.height()}},{key:"draw",value:function(){var e=this.soupView.soup,t=this.soupView.currentView.cameraParams;this.maxZLength=2*e.maxLength;var i=this.zToY(t.zBack),s=this.zToY(t.zFront),r=this.zToY(0);this.fillRect(0,0,this.width(),this.height(),this.backColor),this.fillRect(0,i,this.width(),r-i,this.zBackColor),this.fillRect(0,r,this.width(),s-r,this.zFrontColor);var n="12px sans-serif",a=this.width()/2;this.text("zslab",a,10,n,this.zFrontColor,"center"),this.text("back",a,i-7,n,this.zBackColor,"center"),this.text("front",a,s+7,n,this.zFrontColor,"center")}},{key:"getZ",value:function(e){this.getPointer(e),this.z=this.yToZ(this.pointerY)}},{key:"mousedown",value:function(e){this.getZ(e),this.z>0?(this.back=!0,this.front=!1):(this.front=!0,this.back=!1),_t()(t.prototype.__proto__||Q()(t.prototype),"mousedown",this).call(this,e)}},{key:"mousemove",value:function(e){if(e.preventDefault(),this.mousePressed){this.getZ(e);var t=this.soupView.currentView.cameraParams;this.back?t.zBack=Math.max(2,this.z):this.front&&(t.zFront=Math.min(-2,this.z)),this.soupView.changed=!0,this.draw()}}}]),t}(xt),At=function(e){function t(e){f()(this,t);var i=$()(this,(t.__proto__||Q()(t)).call(this,e.divTag));return i.isGrid=e.isGrid,i.soupView=e.soupView,i.buttonHeight=40,i.sliderHeight=6*i.buttonHeight-50,i.div.attr("id","grid-control"),i.isGrid||i.div.css("display","none"),i.div.css("height",i.height()),i.backgroundColor="#AAA",i.buttonsDiv=y()('<div id="grid-control-buttons">'),i.div.append(i.buttonsDiv),i}return J()(t,e),g()(t,[{key:"reset",value:function(){if(this.isGrid){this.buttonsDiv.empty();var e=10,t=!0,i=!1,s=void 0;try{for(var n,a=r()(b.a.keys(this.soupView.soup.grid.isElem));!(t=(n=a.next()).done);t=!0){var o=n.value;this.buttonsDiv.append(this.makeElemButton(o,e)),e+=this.buttonHeight}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}0===b.a.keys(this.soupView.soup.grid.isElem).length?this.div.hide():this.div.show()}}},{key:"makeElemButton",value:function(e,t){var i=this,s=Fe[e].getHexString(),r=H("toggle_text",e,"jolecule-button",function(){return i.soupView.soup.grid.isElem[e]},function(t){i.soupView.soup.grid.isElem[e]=t,i.soupView.soup.grid.changed=!0,i.soupView.changed=!0},s);return r.css("position","absolute"),r.css("top",t+"px"),r.css("left","40px"),r.css("width","20px"),r}},{key:"resize",value:function(){this.isGrid&&(this.div.css({width:this.width(),height:this.height(),top:this.y(),left:this.x()}),this.canvasDom.width=this.width(),this.canvasDom.height=this.height())}},{key:"width",value:function(){return 84}},{key:"height",value:function(){return 6*this.buttonHeight+10}},{key:"x",value:function(){return this.parentDiv.position().left}},{key:"y",value:function(){return this.parentDiv.position().top+60}},{key:"yToZ",value:function(e){var t=(e-20)/this.sliderHeight,i=this.soupView.soup.grid,s=t*(i.bMax-i.bMin)+i.bMin;return s<this.soupView.soup.grid.bMin&&(s=this.soupView.soup.grid.bMin),s>this.soupView.soup.grid.bMax&&(s=this.soupView.soup.grid.bMax),s}},{key:"zToY",value:function(e){var t=this.soupView.soup.grid,i=t.bMax-t.bMin;return(e-t.bMin)/i*this.sliderHeight+20}},{key:"draw",value:function(){if(this.isGrid){this.fillRect(0,0,this.width(),this.height(),this.backgroundColor);var e="rgb(100, 100, 100)",t=this.zToY(this.soupView.soup.grid.bMin),i=this.zToY(this.soupView.soup.grid.bMax);this.line(20,t,20,i,1,e),this.line(5,t,35,t,1,e);var s=this.zToY(this.soupView.soup.grid.bCutoff);this.fillRect(5,s,30,5,"#666"),this.text(-this.soupView.soup.grid.bCutoff.toFixed(2),20,s+15,"12px sans-serif","#666","center")}}},{key:"getZ",value:function(e){this.getPointer(e),this.z=this.yToZ(this.pointerY)}},{key:"mousedown",value:function(e){e.preventDefault(),this.getZ(e),this.mousePressed=!0,this.mousemove(e)}},{key:"mousemove",value:function(e){e.preventDefault(),this.mousePressed&&(this.getZ(e),this.soupView.soup.grid.bCutoff=this.z,this.soupView.soup.grid.changed=!0,this.draw(),this.soupView.changed=!0)}},{key:"mouseup",value:function(e){e.preventDefault(),this.mousePressed=!1}}]),t}(xt),Tt={LineElement:bt,PopupText:kt,AtomLabelsWidget:Ct,DistanceMeasuresWidget:St,SequenceWidget:Vt,ZSlabWidget:Pt,GridControlWidget:At},Rt=function(){function e(t,i,s,r,n){f()(this,e),this.divTag=i,this.div=y()(this.divTag),this.div.css("overflow","hidden"),this.backgroundColor=n,this.div.css("background-color",this.backgroundColor),this.saveMouseX=null,this.saveMouseY=null,this.saveMouseR=null,this.saveMouseT=null,this.mouseX=null,this.mouseY=null,this.mouseR=null,this.mouseT=null,this.mousePressed=!1,this.webglDivId=this.div.attr("id")+"-canvas-wrapper",this.webglDiv=y()("<div>").attr("id",this.webglDivId).css("overflow","hidden").css("z-index","0").css("background-color","#CCC").css("position","absolute"),this.webglDiv.contextmenu(function(){return!1}),this.div.append(this.webglDiv),this.cameraParams={focus:new V.Vector3(0,0,0),position:new V.Vector3(0,0,-1),up:new V.Vector3(0,1,0),zFront:-40,zBack:20,zoom:1},this.camera=new V.PerspectiveCamera(45,this.width()/this.height()),this.displayScene=new V.Scene,this.displayScene.background=new V.Color(this.backgroundColor),this.displayScene.fog=new V.Fog(this.backgroundColor,1,100),this.displayMeshes={},this.displayMaterial=new V.MeshLambertMaterial({vertexColors:V.VertexColors}),this.pickingScene=new V.Scene,this.pickingTexture=new V.WebGLRenderTarget(this.width(),this.height()),this.pickingTexture.texture.minFilter=V.LinearFilter,this.pickingMeshes={},this.pickingMaterial=new V.MeshBasicMaterial({vertexColors:V.VertexColors}),this.lights=[],this.buildLights(),this.soupView=t,this.soup=t.soup,this.controller=s,this.nDataServer=0,this.traces=[],this.atomRadius=.35,this.buildCrossHairs(),this.messageDiv=y()("<div>").attr("id","loading-message").addClass("jolecule-loading-message"),this.setMesssage("Loading data..."),this.hover=new Tt.PopupText(this.divTag,"lightblue"),this.sequenceWidget=new Tt.SequenceWidget(this),this.zSlabWidget=new Tt.ZSlabWidget(this),this.isGrid=r,this.gridControlWidget=new Tt.GridControlWidget(this),this.distanceWidget=new Tt.DistanceMeasuresWidget(this),this.labelWidget=new Tt.AtomLabelsWidget(this),this.lineElement=new Tt.LineElement(this,"#FF7777")}return g()(e,[{key:"initWebglRenderer",value:function(){var e=this;this.renderer=new V.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(this.backgroundColor),this.renderer.setSize(this.width(),this.height());var t=this.renderer.domElement;this.webglDiv[0].appendChild(t);var i=function(e,i){t.addEventListener(e,i)};i("mousedown",function(t){return e.mousedown(t)}),i("mousemove",function(t){return e.mousemove(t)}),i("mouseup",function(t){return e.mouseup(t)}),i("mousewheel",function(t){return e.mousewheel(t)}),i("DOMMouseScroll",function(t){return e.mousewheel(t)}),i("touchstart",function(t){return e.mousedown(t)}),i("touchmove",function(t){return e.mousemove(t)}),i("touchend",function(t){return e.mouseup(t)}),i("touchcancel",function(t){return e.mouseup(t)}),i("gesturestart",function(t){return e.gesturestart(t)}),i("gesturechange",function(t){return e.gesturechange(t)}),i("gestureend",function(t){return e.gestureend(t)})}},{key:"setMesssage",value:function(e){console.log("Display.setProcessingMessage:",e),this.messageDiv.html(e).show(),function(e,t,i,s){t.css({position:"absolute","z-index":"9000"});var r=e.position().top,n=e.position().left;e.append(t),t.css({top:r+s,left:n+i})}(this.div,this.messageDiv,100,90)}},{key:"asyncSetMesssage",value:function(){var e=v()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setMesssage(t),e.next=3,Y(0);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cleanupMessage",value:function(){this.messageDiv.hide()}},{key:"calculateTracesForRibbons",value:function(){var e=this;this.traces.length=0;for(var t=void 0,i=this.soup.getResidueProxy(),s=this.soup.getAtomProxy(),n=0;n<this.soup.getResidueCount();n+=1)if(i.iRes=n,i.isPolymer){0!==n&&i.isConnectedToPrev()||function(){var s=new re;s.getReference=function(e){return i.iRes=s.indices[e],i},e.traces.push(s),t=s}(),t.indices.push(n),s.iAtom=i.iAtom,t.points.push(s.pos.clone());var a=i.normal;t.normals.push(a)}var o=!0,u=!1,l=void 0;try{for(var h,c=r()(this.traces);!(o=(h=c.next()).done);o=!0){var d=h.value;d.calcTangents(),d.calcNormals(),d.calcBinormals(),d.expand()}}catch(e){u=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}}},{key:"buildLights",value:function(){var e=new V.DirectionalLight(16777215);e.position.copy(U.create(.2,.2,-100).normalize()),e.dontDelete=!0,this.lights.push(e);var t=new V.AmbientLight(2105376);t.dontDelete=!0,this.lights.push(t);for(var i=0;i<this.lights.length;i+=1)this.displayScene.add(this.lights[i])}},{key:"buildScene",value:function(){this.soupView.initViewsAfterSoupLoad();var e=this.soup.getResidueProxy(),t=!0,i=!1,s=void 0;try{for(var n,a=r()(b.a.range(this.soup.getResidueCount()));!(t=(n=a.next()).done);t=!0){var o=n.value;e.iRes=o,e.color=Je(e.ss)}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}this.soup.findGridLimits(),this.calculateTracesForRibbons(),this.buildMeshOfTube(),this.buildMeshOfGrid(),this.buildMeshOfLigands(),this.buildMeshOfNucleotides(),this.buildMeshOfArrows(),this.rebuildSceneWithMeshes(),this.sequenceWidget.reset(),this.gridControlWidget.reset(),this.soupView.updateView=!0}},{key:"createOrClearMesh",value:function(e){e in this.displayMeshes?le(this.displayMeshes[e]):this.displayMeshes[e]=new V.Object3D,e in this.pickingMeshes?le(this.pickingMeshes[e]):this.pickingMeshes[e]=new V.Object3D}},{key:"rebuildSceneWithMeshes",value:function(){le(this.displayScene),le(this.pickingScene);var e=!0,t=!1,i=void 0;try{for(var s,n=r()(b.a.values(this.displayMeshes));!(e=(s=n.next()).done);e=!0){var a=s.value;a.children.length>0&&this.displayScene.add(a)}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}var o=!0,u=!1,l=void 0;try{for(var h,c=r()(b.a.values(this.pickingMeshes));!(o=(h=c.next()).done);o=!0){var d=h.value;d.children.length>0&&this.pickingScene.add(d)}}catch(e){u=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}}},{key:"setMeshVisible",value:function(e,t){if(t&&!(e in this.displayMeshes)){var i="buildMeshOf"+b.a.capitalize(e);console.log("Display."+i),this[i](),this.updateMeshesInScene=!0}e in this.displayMeshes&&ue(this.displayMeshes[e],t),e in this.pickingMeshes&&ue(this.pickingMeshes[e],t)}},{key:"addGeomToDisplayMesh",value:function(e,t,i){if(0!==t.vertices.length){var s=new V.Mesh(t,this.displayMaterial);b.a.isUndefined(i)||(s.i=i),this.displayMeshes[e].add(s)}}},{key:"addGeomToPickingMesh",value:function(e,t,i){if(0!==t.vertices.length){var s=new V.Mesh(t,this.pickingMaterial);b.a.isUndefined(i)||(s.i=i),this.pickingMeshes[e].add(s)}}},{key:"buildMeshOfRibbons",value:function(){this.createOrClearMesh("ribbons");var e,t=new V.Geometry,i=new V.Geometry,s=!0,n=!1,a=void 0;try{for(var o,u=r()(this.traces);!(s=(o=u.next()).done);s=!0){var l=o.value,h=l.points.length,c=!0,d=!1,v=void 0;try{for(var p,f=r()(b.a.range(h));!(c=(p=f.next()).done);c=!0){var m=p.value,g=l.getReference(m),w="C"===(e=g.ss)||"-"===e?it:tt,y=g.color,_=g.iAtom,x="C"===g.ss,k=0===m||g.ss!==l.getReference(m-1).ss,C=m===h-1||g.ss!==l.getReference(m+1).ss,S=l.getSegmentGeometry(m,w,x,k,C,y);t.merge(S),pe(S,Xe(_)),i.merge(S)}}catch(e){d=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw v}}}}catch(e){n=!0,a=e}finally{try{!s&&u.return&&u.return()}finally{if(n)throw a}}this.addGeomToDisplayMesh("ribbons",t),this.addGeomToPickingMesh("ribbons",i)}},{key:"buildMeshOfTube",value:function(){this.createOrClearMesh("tube");var e=new se(this.traces,it,!0,!1,!1),t=new V.Mesh(e,this.displayMaterial);this.displayMeshes.tube.add(t)}},{key:"buildMeshOfArrows",value:function(){this.createOrClearMesh("arrows");var e=0,t=!0,i=!1,s=void 0;try{for(var n,a=r()(this.traces);!(t=(n=a.next()).done);t=!0){e+=n.value.points.length}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}var o,u=new ne,l=(new V.BufferGeometry).fromGeometry(u),h=new ge(l,e),c=new ge(l,e),d=new V.Object3D,v=0,p=!0,f=!1,m=void 0;try{for(var g,w=r()(this.traces);!(p=(g=w.next()).done);p=!0){var y=g.value,_=y.points.length,x=!0,k=!1,C=void 0;try{for(var S,P=r()(b.a.range(_));!(x=(S=P.next()).done);x=!0){var A=S.value,T=y.points[A],R=y.tangents[A],D=y.binormals[A],E=T.clone().add(R),M=y.getReference(A),O="E"===(o=M.ss)?Le:"H"===o?Be:"D"===o?ze:"C"===o?Ie:"W"===o?Ne:Ue,I=M.iAtom;d.matrix.identity(),d.position.copy(T),d.up.copy(D),d.lookAt(E),d.updateMatrix(),h.applyMatrixToCopy(d.matrix,v),h.applyColorToCopy(O,v),c.applyMatrixToCopy(d.matrix,v),c.applyColorToCopy(Xe(I),v),v+=1}}catch(e){k=!0,C=e}finally{try{!x&&P.return&&P.return()}finally{if(k)throw C}}}}catch(e){f=!0,m=e}finally{try{!p&&w.return&&w.return()}finally{if(f)throw m}}var B=new V.Mesh(h,this.displayMaterial);this.displayMeshes.arrows.add(B);var L=new V.Mesh(c,this.pickingMaterial);this.pickingMeshes.arrows.add(L)}},{key:"buildAtomMeshes",value:function(e,t){if(0!==e.length){for(var i,s,r,n=e.length,a=new V.SphereBufferGeometry(1,8,8),o=new ge(a,n),u=new ge(a,n),l=this.soup.getAtomProxy(),h=0;h<n;h+=1){var c=e[h];l.iAtom=c;var d=(i=l.pos,s=this.atomRadius,r=void 0,(r=new V.Object3D).matrix.identity(),r.position.copy(i),r.scale.set(s,s,s),r.updateMatrix(),r.matrix);o.applyMatrixToCopy(d,h),u.applyMatrixToCopy(d,h),o.applyColorToCopy(l.color,h),u.applyColorToCopy(Xe(c),h)}var v=new V.Mesh(o,this.displayMaterial);this.displayMeshes[t].add(v);var p=new V.Mesh(u,this.pickingMaterial);this.pickingMeshes[t].add(p)}}},{key:"buildBondMeshes",value:function(e,t){if(0!==e.length){var i=e.length,s=new V.CylinderBufferGeometry(1,1,1,4,1,!1);s.applyMatrix((new V.Matrix4).makeRotationFromEuler(new V.Euler(Math.PI/2,Math.PI,0)));for(var r=new ge(s,i),n=this.soup.getAtomProxy(),a=this.soup.getAtomProxy(),o=this.soup.getBondProxy(),u=this.soup.getResidueProxy(),l=0;l<i;l+=1){var h=e[l];o.iBond=h,n.iAtom=o.iAtom1,a.iAtom=o.iAtom2,u.iRes=n.iRes;var c=n.pos.clone(),d=a.pos.clone();if(n.iRes!==a.iRes){var v=d.clone().add(c).multiplyScalar(.5);n.iRes===u.iRes?d=v:a.iRes===u.iRes&&(c=v)}var p=fe(c,d,.2);r.applyMatrixToCopy(p,l),r.applyColorToCopy(u.color,l)}var f=new V.Mesh(r,this.displayMaterial);this.displayMeshes[t].add(f)}}},{key:"buildSelectedResidues",value:function(e){this.createOrClearMesh("sidechains");var t=[],i=[],s=this.soup.getAtomProxy(),n=this.soup.getResidueProxy(),a=!0,o=!1,u=void 0;try{for(var l,h=r()(b.a.range(this.soup.getResidueCount()));!(a=(l=h.next()).done);a=!0){var c=l.value;if(n.iRes=c,n.isPolymer)if(e||n.selected){var d=!0,v=!1,p=void 0;try{for(var f,m=r()(n.getAtomIndices());!(d=(f=m.next()).done);d=!0){var g=f.value;if(s.iAtom=g,!G(s.atomType,et)){t.push(g);var w=!0,y=!1,_=void 0;try{for(var x,k=r()(s.getBondIndices());!(w=(x=k.next()).done);w=!0){var C=x.value;i.push(C)}}catch(e){y=!0,_=e}finally{try{!w&&k.return&&k.return()}finally{if(y)throw _}}}}}catch(e){v=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(v)throw p}}}}}catch(e){o=!0,u=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw u}}this.buildAtomMeshes(t,"sidechains"),this.buildBondMeshes(i,"sidechains")}},{key:"buildMeshOfBackbone",value:function(){this.createOrClearMesh("backbone");var e=[],t=[],i=this.soup.getAtomProxy(),s=this.soup.getResidueProxy(),n=!0,a=!1,o=void 0;try{for(var u,l=r()(b.a.range(this.soup.getResidueCount()));!(n=(u=l.next()).done);n=!0){var h=u.value;if(s.iRes=h,s.isPolymer){var c=!0,d=!1,v=void 0;try{for(var p,f=r()(s.getAtomIndices());!(c=(p=f.next()).done);c=!0){var m=p.value;if(i.iAtom=m,G(i.atomType,et)){e.push(m);var g=!0,w=!1,y=void 0;try{for(var _,x=r()(i.getBondIndices());!(g=(_=x.next()).done);g=!0){var k=_.value;t.push(k)}}catch(e){w=!0,y=e}finally{try{!g&&x.return&&x.return()}finally{if(w)throw y}}}}}catch(e){d=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw v}}}}}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}this.buildAtomMeshes(e,"backbone"),this.buildBondMeshes(t,"backbone")}},{key:"buildMeshOfLigands",value:function(){this.createOrClearMesh("ligands");var e=[],t=[],i=this.soup.getAtomProxy(),s=this.soup.getResidueProxy(),n=!0,a=!1,o=void 0;try{for(var u,l=r()(b.a.range(this.soup.getResidueCount()));!(n=(u=l.next()).done);n=!0){var h=u.value;if(s.iRes=h,"-"===s.ss){var c=!0,d=!1,v=void 0;try{for(var p,f=r()(s.getAtomIndices());!(c=(p=f.next()).done);c=!0){var m=p.value;i.iAtom=m,e.push(m);var g=!0,w=!1,y=void 0;try{for(var _,x=r()(i.getBondIndices());!(g=(_=x.next()).done);g=!0){var k=_.value;t.push(k)}}catch(e){w=!0,y=e}finally{try{!g&&x.return&&x.return()}finally{if(w)throw y}}}}catch(e){d=!0,v=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw v}}}}}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}this.buildAtomMeshes(e,"ligands"),this.buildBondMeshes(t,"ligands")}},{key:"buildMeshOfWater",value:function(){this.createOrClearMesh("water");var e=[],t=this.soup.getResidueProxy(),i=!0,s=!1,n=void 0;try{for(var a,o=r()(b.a.range(this.soup.getResidueCount()));!(i=(a=o.next()).done);i=!0){var u=a.value;t.iRes=u,"HOH"===t.resType&&e.push(t.iAtom)}}catch(e){s=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(s)throw n}}this.buildAtomMeshes(e,"water")}},{key:"buildMeshOfGrid",value:function(){if(this.gridControlWidget.isGrid){this.createOrClearMesh("grid");var e=this.soupView.soup.grid,t=[],i=this.soup.getResidueProxy(),s=this.soup.getAtomProxy(),n=!0,a=!1,o=void 0;try{for(var u,l=r()(b.a.range(this.soup.getResidueCount()));!(n=(u=l.next()).done);n=!0){var h=u.value;i.iRes=h,"G"===i.ss&&(s.iAtom=i.iAtom,s.bfactor>e.bCutoff&&e.isElem[s.elem]&&t.push(s.iAtom))}}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}this.buildAtomMeshes(t,"grid")}}},{key:"buildMeshOfNucleotides",value:function(){this.createOrClearMesh("basepairs");var e=new V.Geometry,t=new V.Geometry,i=new ae,s=this.soup.getResidueProxy(),n=this.soup.getAtomProxy(),a=!0,o=!1,u=void 0;try{for(var l,h=r()(b.a.range(this.soup.getResidueCount()));!(a=(l=h.next()).done);a=!0){var c=l.value;if(s.iRes=c,"D"===s.ss&&s.isPolymer){var d=new V.Geometry,v=void 0,p=void 0;if("DA"===s.resType||"A"===s.resType)v=["N9","C8","N7","C5","C6","N1","C2","N3","C4"],p=[["C3'","C2'"],["C2'","C1'"],["C1'","N9"]];else if("DG"===s.resType||"G"===s.resType)v=["N9","C8","N7","C5","C6","N1","C2","N3","C4"],p=[["C3'","C2'"],["C2'","C1'"],["C1'","N9"]];else if("DT"===s.resType||"U"===s.resType)v=["C6","N1","C2","N3","C4","C5"],p=[["C3'","C2'"],["C2'","C1'"],["C1'","N1"]];else{if("DC"!==s.resType&&"C"!==s.resType)continue;v=["C6","N1","C2","N3","C4","C5"],p=[["C3'","C2'"],["C2'","C1'"],["C1'","N1"]]}var f=function(e,t){return s.iRes=e,b.a.map(t,function(e){return n.iAtom=s.getIAtom(e),n.pos.clone()})},m=f(c,v),g=new oe(m,.2);d.merge(g);var w=!0,y=!1,_=void 0;try{for(var x,k=r()(p);!(w=(x=k.next()).done);w=!0){var C=x.value,S=f(c,[C[0],C[1]]);d.merge(i,fe(S[0],S[1],.2))}}catch(e){y=!0,_=e}finally{try{!w&&k.return&&k.return()}finally{if(y)throw _}}d.faceVertexUvs=[[]],pe(d,s.color),e.merge(d),pe(d,Xe(s.iAtom)),t.merge(d)}}}catch(e){o=!0,u=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw u}}this.addGeomToDisplayMesh("basepairs",e),this.addGeomToPickingMesh("basepairs",t)}},{key:"buildCrossHairs",value:function(){var e=new V.LineDashedMaterial({color:16742263,linewidth:2}),t=new V.CircleGeometry(1.2,60);t.vertices.shift(),this.crossHairs=new V.Line(t,e),this.crossHairs.dontDelete=!0,this.displayScene.add(this.crossHairs)}},{key:"setTargetViewFromAtom",value:function(e){this.controller.setTargetViewByAtom(e)}},{key:"getCurrentViewCamera",value:function(){return this.soupView.currentView.cameraParams}},{key:"rotateCameraToCurrentView",value:function(){var e=this.soupView.currentView.cameraParams,t=this.cameraParams.position.clone().sub(this.cameraParams.focus).normalize(),i=e.position.clone().sub(e.focus);i.normalize();for(var s=de(t,i),r=0;r<this.lights.length;r+=1)this.lights[r].position.applyQuaternion(s);this.cameraParams=e;var n=this.cameraParams.zoom+this.cameraParams.zBack,a=this.cameraParams.zoom+this.cameraParams.zFront;a<1&&(a=1),this.camera.position.copy(this.cameraParams.position),this.camera.up.copy(this.cameraParams.up),this.camera.lookAt(this.cameraParams.focus),this.camera.near=a,this.camera.far=n,this.camera.updateProjectionMatrix(),this.displayScene.fog.near=a,this.displayScene.fog.far=n}},{key:"adjustCamera",value:function(e,t,i,s){var r=this.getCurrentViewCamera(),n=r.up,a=r.position.clone().sub(r.focus).normalize(),o=U.create().crossVectors(n,a).normalize(),u=(new V.Quaternion).setFromAxisAngle(a,i),l=(new V.Quaternion).setFromAxisAngle(n,-t),h=(new V.Quaternion).setFromAxisAngle(o,-e),c=(new V.Quaternion).multiply(u).multiply(l).multiply(h),d=s*r.zoom;d<2&&(d=2);var v=r.position.clone().sub(r.focus).applyQuaternion(c).normalize().multiplyScalar(d).add(r.focus),p=this.soupView.currentView.clone();p.cameraParams.focus=r.focus.clone(),p.cameraParams.position=v,p.cameraParams.up=r.up.clone().applyQuaternion(c),p.cameraParams.zoom=d,this.controller.setCurrentView(p)}},{key:"getZ",value:function(e){var t=this.getCurrentViewCamera(),i=t.focus.clone().sub(t.position).normalize();return e.clone().sub(t.focus).dot(i)}},{key:"inZlab",value:function(e){var t=this.getZ(e),i=this.getCurrentViewCamera();return t>=i.zFront&&t<=i.zBack}},{key:"opacity",value:function(e){var t=this.getZ(e),i=this.getCurrentViewCamera();return t<i.zFront?1:t>i.zBack?0:1-(t-i.zFront)/(i.zBack-i.zFront)}},{key:"posXY",value:function(e){var t=.5*this.width(),i=.5*this.height(),s=e.clone().project(this.camera);return{x:s.x*t+t+this.x(),y:-s.y*i+i+this.y()}}},{key:"updateCrossHairs",value:function(){var e=this.getCurrentViewCamera();this.crossHairs.position.copy(e.focus),this.crossHairs.lookAt(e.position),this.crossHairs.updateMatrix()}},{key:"atomLabelDialog",value:function(){var e=this,t=this.soupView.currentView.iAtom;if(t>=0){var i="Label atom : "+this.soup.getAtomProxy(t).label;!function(e,t,i){function s(){l.remove(),window.keyboard_lock=!1}function r(){s(),window.keyboard_lock=!1}t||(t=""),window.keyboard_lock=!0;var n=W("okay","okay","jolecule-small-button",function(){i(o.val()),s(),window.keyboard_lock=!1}),a=W("discard","discard","jolecule-small-button",r),o=y()("<textarea>").css("width","100%").addClass("jolecule-view-text").keydown(function(e){if(27===e.keyCode)return r(),!0}),u=y()("<div>").css("width","100%").append(t).append(o).append(n).append(" ").append(a),l=y()("<div>").addClass("jolecule-dialog").css("display","block").css("z-index","2000").css("width",Math.min(400,e.width()-100)).append(u);!function(e,t,i,s){t.css({position:"absolute","z-index":"9000"});var r=e.position().top,n=e.position().left,a=e.outerWidth(),o=e.outerHeight();e.prepend(t);var u=t.outerWidth(),l=t.outerHeight();t.css({top:r+o/2-l/2-s,left:n+a/2-u/2-i})}(e,l,0,70),setTimeout(function(){u.find("textarea").focus()},100)}(this.div,i,function(i){e.controller.makeAtomLabel(t,i)})}}},{key:"getIAtomHover",value:function(){var e=this.mouseX,t=this.mouseY;if(null===e||null===t)return null;var i=new Uint8Array(4);this.renderer.render(this.pickingScene,this.camera,this.pickingTexture),this.renderer.readRenderTargetPixels(this.pickingTexture,this.mouseX,this.pickingTexture.height-t,1,1,i);var s=i[0]<<16|i[1]<<8|i[2];return s<this.soup.getAtomCount()?s:null}},{key:"updateHover",value:function(){if(this.soupView.nUpdateStep>1)this.hover.hide();else if(this.iHoverAtom=this.getIAtomHover(),this.iHoverAtom){var e=this.soup.getAtomProxy(this.iHoverAtom),t=e.label,i=e.iAtom,s=e.pos.clone();i===this.soupView.getCenteredAtom().iAtom&&(t='<div style="text-align: center">',t+=e.label,t+="<br>[drag distances]<br>",t+="[double-click labels]",t+="</div>"),this.hover.html(t);var r=this.posXY(s);this.hover.move(r.x,r.y)}else this.hover.hide()}},{key:"isChanged",value:function(){return this.soupView.changed}},{key:"draw",value:function(){if(this.isChanged()){this.updateMeshesInScene=!1;var e=this.soupView.currentView.show;this.setMeshVisible("tube",e.trace),this.setMeshVisible("water",e.water),this.setMeshVisible("ribbons",e.ribbon),this.setMeshVisible("arrows",!e.backboneAtoms),this.setMeshVisible("backbone",e.backboneAtom),this.setMeshVisible("ligands",e.ligands),this.soupView.soup.grid.changed&&(this.buildMeshOfGrid(),this.soupView.soup.grid.changed=!1,this.updateMeshesInScene=!0),this.soupView.updateResidueSelection&&(this.buildSelectedResidues(e.sidechain),this.soupView.updateResidueSelection=!1,this.updateMeshesInScene=!0),this.updateMeshesInScene&&this.rebuildSceneWithMeshes(),this.updateCrossHairs(),this.rotateCameraToCurrentView(),this.distanceWidget.draw(),N(this.renderer)||this.initWebglRenderer(),this.renderer.render(this.displayScene,this.camera),this.soupView.updateView&&(this.zSlabWidget.draw(),this.sequenceWidget.draw(),this.gridControlWidget.draw(),this.soupView.updateView=!1),this.labelWidget.draw(),this.soupView.changed=!1}}},{key:"animate",value:function(){if(null!==this.soupView.targetView){this.soupView.nUpdateStep-=1;var e=this.soupView.nUpdateStep;if(!(e<=0)){var t=mt(this.soupView.currentView.cameraParams,this.soupView.targetView.cameraParams,1/e),i=this.soupView.targetView.clone();i.setCamera(t),this.controller.setCurrentView(i),this.updateHover()}}}},{key:"resize",value:function(){console.log("Display.resize"),this.zSlabWidget.resize(),this.gridControlWidget.resize(),this.sequenceWidget.resize();var e=this.div.position();this.webglDiv.css("left",this.x()+e.left),this.webglDiv.css("top",this.y()+e.top),this.camera.aspect=this.width()/this.height(),this.camera.updateProjectionMatrix(),this.pickingTexture.setSize(this.width(),this.height()),this.soupView.updateView=!0,this.controller.setChangeFlag(),N(this.renderer)&&this.renderer.setSize(this.width(),this.height())}},{key:"x",value:function(){return 0}},{key:"y",value:function(){var e=0;return b.a.isUndefined(this.sequenceWidget)||(e+=this.sequenceWidget.height()),e}},{key:"width",value:function(){var e=this.div.width()-this.x();return b.a.isUndefined(this.zSlabWidget)||(e-=this.zSlabWidget.width()),e}},{key:"height",value:function(){return this.div.height()-this.y()}},{key:"getMouse",value:function(e){N(e.touches)&&e.touches.length>0?(this.eventX=e.touches[0].clientX,this.eventY=e.touches[0].clientY):(this.eventX=e.clientX,this.eventY=e.clientY);var t=e.target.getBoundingClientRect();this.mouseX=this.eventX-t.left,this.mouseY=this.eventY-t.top;var i=this.mouseX-this.width()/2,s=this.mouseY-this.height()/2;this.mouseR=Math.sqrt(i*i+s*s),this.mouseT=Math.atan(s/i),i<0&&(s>0?this.mouseT+=Math.PI:this.mouseT-=Math.PI)}},{key:"saveMouse",value:function(){this.saveMouseX=this.mouseX,this.saveMouseY=this.mouseY,this.saveMouseR=this.mouseR,this.saveMouseT=this.mouseT}},{key:"doubleclick",value:function(){null!==this.iHoverAtom&&(this.iHoverAtom===this.soupView.getCenteredAtom().iAtom?this.atomLabelDialog():this.setTargetViewFromAtom(this.iHoverAtom),this.isDraggingCentralAtom=!1)}},{key:"mousedown",value:function(e){this.getMouse(e),e.preventDefault();var t=(new Date).getTime(),i=t-this.timePressed<500;this.updateHover(),this.iDownAtom=this.getIAtomHover(),i?this.doubleclick():this.isDraggingCentralAtom=null!==this.iDownAtom,this.timePressed=t,this.saveMouse(),this.mousePressed=!0}},{key:"mousemove",value:function(e){if(this.getMouse(e),e.preventDefault(),!this.isGesture)if(this.updateHover(),this.isDraggingCentralAtom){var t=this.posXY(this.soup.getAtomProxy(this.iDownAtom).pos);this.lineElement.move(this.mouseX+this.x(),this.mouseY+this.y(),t.x,t.y)}else{var i=1===e.shiftKey,s=2===e.button||3===e.which;if(this.mousePressed){var r=1,n=0,a=0,o=0;s||i?(n=this.mouseT-this.saveMouseT,this.mouseR>0&&(r=this.saveMouseR/this.mouseR)):(a=U.degToRad(this.mouseX-this.saveMouseX),o=U.degToRad(this.mouseY-this.saveMouseY)),this.adjustCamera(o,a,n,r),this.saveMouse()}}}},{key:"mousewheel",value:function(e){e.preventDefault();var t=void 0;t=N(e.wheelDelta)?e.wheelDelta/120:-e.detail/12;var i=Math.pow(1+Math.abs(t)/2,t>0?1:-1);this.adjustCamera(0,0,0,i)}},{key:"mouseup",value:function(e){this.getMouse(e),e.preventDefault(),this.isDraggingCentralAtom&&(null!==this.iHoverAtom&&this.iHoverAtom!==this.iDownAtom&&this.controller.makeDistance(this.iHoverAtom,this.iDownAtom),this.lineElement.hide(),this.isDraggingCentralAtom=!1),N(e.touches)&&(this.hover.hide(),this.mouseX=null,this.mouseY=null),this.iDownAtom=null,this.mousePressed=!1}},{key:"gesturestart",value:function(e){e.preventDefault(),this.isGesture=!0,this.lastPinchRotation=0,this.lastScale=e.scale*e.scale}},{key:"gesturechange",value:function(e){e.preventDefault(),this.adjustCamera(0,0,U.degToRad(2*e.rotation-this.lastPinchRotation),this.lastScale/(e.scale*e.scale)),this.lastPinchRotation=2*e.rotation,this.lastScale=e.scale*e.scale}},{key:"gestureend",value:function(e){e.preventDefault(),this.isGesture=!1,this.iDownAtom=null,this.mousePressed=!1}}]),e}(),Dt=function(){function e(t){f()(this,e),this.params=t,this.div=y()("<div>").addClass("jolecule-view"),N(t.goto)&&this.div.append(W("",this.params.goto,"jolecule-button",this.params.pick)).append('<div style="width: 10px">'),this.params=t,this.makeEditDiv(),this.makeShowDiv()}return g()(e,[{key:"saveChange",value:function(){console.log("ViewPiece.saveChange");var e=this.editTextArea.val();this.editDiv.hide(),this.showDiv.show(),this.showTextDiv.html(e),this.params.saveChange(e),window.keyboard_lock=!1}},{key:"startEdit",value:function(){this.params.pick(),this.editTextArea.text(this.params.view.text),this.editDiv.show(),this.showDiv.hide();var e=this.editTextArea.find("textarea");setTimeout(function(){e.focus()},100),window.keyboard_lock=!0}},{key:"discardChange",value:function(){this.editDiv.hide(),this.showDiv.show(),window.keyboard_lock=!1}},{key:"makeEditDiv",value:function(){var e=this;this.editTextArea=y()("<textarea>").addClass("jolecule-view-text").css("width","100%").css("height","5em").click(b.a.noop),this.editDiv=y()("<div>").css("width","100%").click(b.a.noop).append(this.editTextArea).append("<br><br>").append(W("","save","jolecule-small-button",function(t){e.saveChange()})).append(" &nbsp; ").append(W("","discard","jolecule-small-button",function(t){e.discardChange()})).hide(),this.div.append(this.editDiv)}},{key:"makeShowDiv",value:function(){var e=this,t=this.params.view,i=W("","edit","jolecule-small-button",function(){e.startEdit()});this.showTextDiv=y()("<div>").addClass("jolecule-view-text").html(this.params.view.text),this.showDiv=y()("<div>").css("width","100%").append(this.showTextDiv),"view:000000"!==t.id&&this.showDiv.append(y()("<div>").addClass("jolecule-author").html(t.creator)),this.params.isEditable&&!t.lock&&"view:000000"!==t.id&&(this.showDiv.append(i),N(this.params.swapUp)&&this.params.swapUp&&this.showDiv.append(" ").append(W("","up","jolecule-small-button",function(){e.params.swapUp()})),N(this.params.swapUp)&&this.params.swapDown&&this.showDiv.append(" ").append(W("","down","jolecule-small-button",function(){e.params.swapDown()})),N(this.params.deleteView)&&this.showDiv.append(y()("<div>").css("float","right").append(W("","delete","jolecule-small-button",function(){console.log("ViewPiece.deleteButton"),e.params.deleteView()})))),this.div.append(this.showDiv)}}]),e}(),Et={divTag:"",viewId:"",viewHeight:170,isViewTextShown:!1,isEditable:!0,isLoop:!1,isGrid:!1,backgroundColor:13421772},Mt=function(){function e(t){var i=this;f()(this,e),this.params=t,this.isLoop=this.params.isLoop,this.divTag=this.params.divTag,this.div=y()(this.params.divTag),this.div[0].oncontextmenu=b.a.noop,this.initViewId=this.params.viewId,this.hAnnotationView=this.params.viewHeight,this.soup=new pt,this.soupView=new gt(this.soup),this.controller=new wt(this.soupView),this.residueSelector=null,this.createProteinDiv(),this.display=new Rt(this.soupView,"#jolecule-soup-display",this.controller,t.isGrid,t.backgroundColor),this.createStatusDiv(),this.createViewDiv(),this.isViewTextShown=this.params.isViewTextShown,this.setTextState(),y()(window).resize(function(){return i.resize()}),this.resize(),this.isProcessing={flag:!1}}return g()(e,[{key:"asyncLoadViews",value:function(){var e=v()(l.a.mark(function e(t){var i=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new c.a(function(e){t.get_views(function(t){i.controller.loadViewsFromViewDicts(t),i.updateView(),i.params.viewId in i.soupView.savedViewsByViewId&&(i.controller.setTargetViewByViewId(i.params.viewId),i.updateView()),e()})}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"asyncLoadSoup",value:function(){var e=v()(l.a.mark(function e(t){var i=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new c.a(function(e){var s;t.get_protein_data((s=v()(l.a.mark(function t(s){var r,n,a,o,u,h;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=s.pdb_text,n=s.pdb_id,0!==s.pdb_text.length){t.next=7;break}return t.next=5,i.display.asyncSetMesssage("Error: no soup data");case 5:return e(),t.abrupt("return");case 7:return t.next=9,i.display.asyncSetMesssage("Parsing '"+n+"'");case 9:return i.soup.parsePdbData(r,n),i.soup.assignResidueSsAndCentralAtoms(),i.populateResidueSelector(),i.soup.calcMaxLength(),a=i.soup.getAtomCount(),o=i.soup.getResidueCount(),t.next=17,i.display.asyncSetMesssage("Calculating bonds for "+a+" atoms, "+o+" residues...");case 17:return i.soup.calcBondsStrategic(),u=i.soup.getBondCount(),t.next=21,i.display.asyncSetMesssage("Calculated "+u+" bonds.");case 21:return t.next=23,i.display.asyncSetMesssage("Assigning secondary structure...");case 23:if(i.soup.findBackboneHbonds(),i.soup.findSecondaryStructure(),!i.soup.parsingError){t.next=31;break}return h=i.soup.parsingError,t.next=29,i.display.asyncSetMesssage("Error parsing soup: "+h);case 29:t.next=32;break;case 31:i.display.buildScene();case 32:e();case 33:case"end":return t.stop()}},t,i)})),function(e){return s.apply(this,arguments)}))}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"asyncAddDataServer",value:function(){var e=v()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isProcessing.flag){e.next=5;break}return e.next=3,Y(100);case 3:e.next=0;break;case 5:return this.isProcessing.flag=!0,e.next=8,this.asyncLoadSoup(t);case 8:if(this.display.nDataServer+=1,1!==this.display.nDataServer){e.next=14;break}return e.next=12,this.display.asyncSetMesssage("Loading views...");case 12:return e.next=14,this.asyncLoadViews(t);case 14:this.display.cleanupMessage(),this.isProcessing.flag=!1;case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveViewsToDataServer",value:function(e){this.dataServer.save_views(this.controller.getViewDicts(),e),this.soupView.changed=!0}},{key:"saveCurrView",value:function(){var e=this,t=j();this.controller.saveCurrentView(t),this.updateView(),this.viewDiv.css("background-color","lightgray"),this.saveViewsToDataServer(function(){e.viewDiv.css("background-color","")})}},{key:"getCurrView",value:function(){var e=this.soupView.iLastViewSelected;if(e in this.soupView.savedViews){var t=this.soupView.savedViews[e].id;return this.soupView.savedViewsByViewId[t]}return this.soupView.savedViews[0]}},{key:"changeText",value:function(e){var t=this;this.getCurrView().text=e,this.viewDiv.css("background-color","lightgray"),this.saveViewsToDataServer(function(){t.viewDiv.css("background-color","")}),this.soupView.changed=!0}},{key:"deleteCurrView",value:function(){var e=this,t=this.soupView.iLastViewSelected;if(0!==t){var i=this.soupView.savedViews[t].id;this.controller.deleteView(i),this.viewDiv.css("background-color","lightgray"),this.dataServer.delete_protein_view(i,function(){e.updateView(),e.viewDiv.css("background-color","")})}}},{key:"isChanged",value:function(){return!!N(this.display)&&this.display.isChanged()}},{key:"animate",value:function(){N(this.display)&&(this.display.animate(),this.isLoop&&this.soupView.nUpdateStep<=0&&(this.soupView.nUpdateStep-=1,this.soupView.nUpdateStep<-100&&(this.controller.setTargetToNextView(),this.soupView.changed=!0)))}},{key:"draw",value:function(){N(this.display)&&this.soupView.changed&&(this.updateView(),this.display.draw(),this.populateResidueSelector(),this.soupView.changed=!1)}},{key:"cycleBackbone",value:function(){this.soupView.currentView.show.backboneAtom?this.controller.setBackboneOption("ribbon"):this.soupView.currentView.show.ribbon?this.controller.setBackboneOption("trace"):this.soupView.currentView.show.trace&&this.controller.setBackboneOption("backboneAtom")}},{key:"setTextState",value:function(){this.isViewTextShown?(this.viewDiv.height(this.hAnnotationView),this.viewDiv.css("visibility","visible")):(this.viewDiv.height(0),this.viewDiv.css("visibility","hidden")),this.resize(),this.controller.soupView.changed=!0}},{key:"toggleTextState",value:function(){this.isViewTextShown=!this.isViewTextShown,this.setTextState()}},{key:"gotoPrevView",value:function(){this.controller.setTargetToPrevView(),this.updateView()}},{key:"gotoNextView",value:function(){this.controller.setTargetToNextView(),this.updateView()}},{key:"createProteinDiv",value:function(){var e=this.div.outerHeight()-this.hAnnotationView;this.proteinDiv=y()("<div>").attr("id","jolecule-soup-display").addClass("jolecule-embed-body").css("overflow","hidden").css("width",this.div.outerWidth()).css("height",e),this.div.append(this.proteinDiv)}},{key:"populateResidueSelector",value:function(){this.residueSelector.find("option").remove();for(var e=this.soup.getResidueProxy(),t=0;t<this.soup.getResidueCount();t++){e.iRes=t;var i=e.resId+"-"+e.resType;this.residueSelector.append(y()("<option>").attr("value",t).text(i))}var s=this.soupView.currentView.iAtom,r=this.soup.getAtomProxy(s).iRes;this.residueSelector.val(r)}},{key:"createStatusDiv",value:function(){var e=this;this.statusText=y()("<span>");var t=H("toggle_text","T","jolecule-button",function(){return e.isViewTextShown},function(t){e.toggleTextState()}),i=W("prev_view","<","jolecule-button",function(){e.gotoPrevView()}),s=W("prev_view",">","jolecule-button",function(){e.gotoNextView()}),r=H("loop","&orarr;","jolecule-button",function(){return e.isLoop},function(t){e.isLoop=t}),n="";this.params.isEditable&&(n=W("saveView","+","jolecule-button",function(){e.saveCurrView()})),this.ligButton=H("","lig","jolecule-button",function(){return e.controller.getShowOption("ligands")},function(t){e.controller.setShowOption("ligands",t)}),this.watButton=H("","water","jolecule-button",function(){return e.controller.getShowOption("water")},function(t){e.controller.setShowOption("water",t)}),this.hydButton=H("","h","jolecule-button",function(){return e.controller.getShowOption("hydrogen")},function(t){e.controller.setShowOption("hydrogen",t)}),this.hydButton="";var a=W("","backbone","jolecule-button",function(){e.cycleBackbone()}),o=W("","all","jolecule-button",function(){e.controller.setShowOption("sidechain",!0)}),u=W("","x","jolecule-button",function(){e.controller.setShowOption("sidechain",!1),e.controller.clearSelectedResidues()}),l=W("","near","jolecule-button",function(){e.controller.toggleResidueNeighbors()});this.residueSelector=y()("<select>").addClass("jolecule-residue-selector").css({outline:"none","-moz-appearance":"none"}),this.residueSelector.change(function(){var t=parseInt(e.residueSelector.find(":selected").val());e.display.setTargetViewFromAtom(e.soupView.soup.getResidueProxy(t).iAtom)}),this.viewBarDiv=y()('<div style="width: 100%; display: flex; flex-direction: row">').append(y()('<div style="flex: 1; display: flex; flex-direction: row; align-items: center;">').append(r).append(t).append(i).append(this.statusText).append(s).append(n)).append(y()('<div style="flex: 1; display: flex; flex-direction: row; justify-content: flex-end;">').append(this.residueSelector)),this.sidechainDiv=y()('<div style="width: 100%; display: flex; flex-direction: row; margin-top: 5px">').append(y()('<div style="flex: 1; display: flex; flex-direction: row; align-items: center;">').append(a).append(" ").append(this.ligButton).append(this.hydButton).append(this.watButton).append(" ")).append(y()('<div style="flex: 1; justify-content: flex-end; display: flex; flex-direction: row; align-items: center;">').append(" sidechain: ").append(o).append(u).append(l)),this.statusDiv=y()('<div style="display: flex; flex-direction: column">').addClass("jolecule-embed-view-bar").append(this.viewBarDiv).append(this.sidechainDiv),this.div.append(this.statusDiv)}},{key:"updateView",value:function(){var e=this,t=this.getCurrView();if(null!=t){var i=this.soupView.savedViews.length,s=t.order+1;this.statusText.text(" "+s+"/"+i+" ");var r=new Dt({view:t,isEditable:this.params.isEditable,delete_view:function(){e.deleteCurrView()},save_change:function(t){e.changeText(t)},pick:b.a.noop,embed_view:function(){window.location.href="/embed/pdb/pdb?pdb_id="+t.pdb_id+"&view="+t.id}});this.realViewDiv=r.div,this.realViewDiv.css("overflow-y","auto").css("height","100%"),this.viewDiv.empty().append(this.realViewDiv),this.ligButton.redraw(),this.watButton.redraw(),this.hydButton&&this.hydButton.redraw()}}},{key:"createViewDiv",value:function(){this.viewDiv=y()("<div>").addClass("jolecule-embed-view"),this.div.append(this.viewDiv)}},{key:"resize",value:function(){this.proteinDiv.width(this.div.outerWidth());var e=this.div.outerHeight()-this.viewDiv.outerHeight()-this.statusDiv.outerHeight();N(this.display)&&(N(this.display.renderer)&&(this.display.renderer.domElement.style.height=e),this.soupView.changed=!0),this.proteinDiv.css("height",e),this.display.resize()}}]),e}(),Ot=(i("jAPW"),function(){function e(t,i,s,r,n){var a=this;f()(this,e),this.divTag=t,this.display=s,this.soupView=i.soupView,this.controller=i,this.isEditable=n,this.data_server=r,this.viewPiece={},this.topDiv=y()(this.divTag).append(y()("<div>").addClass("jolecule-sub-header").append("VIEWS OF PROTEIN").append("<br>").append("<br>").append(W("","+[v]iew","jolecule-button",function(){a.makeNewView()})).append(W("","prev[&uarr;]","jolecule-button",function(){a.gotoPrevView()})).append(W("","next[&darr;]","jolecule-button",function(){a.gotoNextView()})).append(W("","+l[a]bel","jolecule-button",function(){a.display.atomLabelDialog()})).append("<br>")).append(y()("<div>").attr("id","jolecule-views"))}return g()(e,[{key:"saveViewsToDataServer",value:function(e){console.log("ViewPieceList.saveViewsToDataServer"),this.data_server.save_views(this.controller.getViewDicts(),e)}},{key:"updateViews",value:function(){for(var e in this.viewPiece)e in this.soupView.savedViewsByViewId||(this.viewPiece[e].div.remove(),delete this.viewPiece[e]);for(var t=0;t<this.soupView.savedViews.length;t++){var i=this.soupView.savedViews[t],s=i.id;i.id in this.viewPiece||this.insertNewViewDiv(i.id);var r=this.soupView.iLastViewSelected;this.soupView.savedViews[r].id===s?(this.viewPiece[s].div.removeClass("jolecule-unselected-box"),this.viewPiece[s].div.addClass("jolecule-selected-box")):(this.viewPiece[s].div.removeClass("jolecule-selected-box"),this.viewPiece[s].div.addClass("jolecule-unselected-box"));var n=this.viewPiece[s];i.text!==n.showTextDiv.html()&&n.showTextDiv.html(i.text),n.div.find("a").eq(0).text(i.order+1)}}},{key:"redrawSelectedViewId",value:function(e){this.updateViews(),y()("#jolecule-views").stop().scrollTo(this.viewPiece[e].div,1e3,{offset:{top:-80}})}},{key:"setTargetByViewId",value:function(e){this.controller.setTargetViewByViewId(e),this.redrawSelectedViewId(e),window.location.hash=e}},{key:"gotoPrevView",value:function(){var e=this.controller.setTargetToPrevView();this.redrawSelectedViewId(e),window.location.hash=e}},{key:"gotoNextView",value:function(){var e=this.controller.setTargetToNextView();this.redrawSelectedViewId(e),window.location.hash=e}},{key:"removeView",value:function(e){var t=this;console.log("ViewPieceList.removeView"),this.viewPiece[e].div.css("background-color","lightgray"),this.data_server.delete_protein_view(e,function(){t.controller.deleteView(e),t.viewPiece[e].div.remove(),delete t.viewPiece[e],t.updateViews()})}},{key:"swapViews",value:function(e,t){var i=this,s=this.soupView.savedViews[e].id,r=this.soupView.savedViews[t].id,n=this.viewPiece[s].div,a=this.viewPiece[r].div;this.controller.swapViews(e,t),n.css("background-color","lightgray"),a.css("background-color","lightgray"),this.saveViewsToDataServer(function(){a.insertBefore(n),i.updateViews(),n.css("background-color",""),a.css("background-color","")})}},{key:"swapUp",value:function(e){var t=this.soupView.getIViewFromViewId(e);t<2||this.swapViews(t-1,t)}},{key:"swapDown",value:function(e){var t=this.soupView.getIViewFromViewId(e);t>this.soupView.savedViews.length-2||this.swapViews(t,t+1)}},{key:"makeViewDiv",value:function(e){var t=this,i=this.soupView.savedViewsByViewId[e];return this.viewPiece[e]=new Dt({view:i,isEditable:this.isEditable,delete_view:function(){t.removeView(e)},save_change:function(s){i.text=s,t.viewPiece[e].div.css("background-color","lightgray"),t.saveViewsToDataServer(function(){t.viewPiece[e].div.css("background-color","")}),t.soupView.changed=!0},pick:function(){t.setTargetByViewId(e)},goto:i.order+1,swapUp:function(){t.swapUp(e)},swapDown:function(){t.swapDown(e)},embed_view:function(){window.location.href="/embed/pdb?pdb_id="+i.pdb_id+"&view="+i.id}}),this.viewPiece[e].div}},{key:"makeAllViews",value:function(){for(var e=0;e<this.soupView.savedViews.length;e+=1){var t=this.soupView.savedViews[e].id,i=this.makeViewDiv(t);y()("#jolecule-views").append(i)}}},{key:"insertNewViewDiv",value:function(e){var t=this.makeViewDiv(e);if(this.soupView.iLastViewSelected===this.soupView.savedViews.length-1)y()("#jolecule-views").append(t);else{var i=this.soupView.iLastViewSelected-1,s=this.soupView.savedViews[i].id,r=this.viewPiece[s].div;t.insertAfter(r)}}},{key:"makeNewView",value:function(){var e=this;console.log("ViewPieceList.makeNewView");var t=j();this.controller.saveCurrentView(t),this.insertNewViewDiv(t),this.updateViews(),this.viewPiece[t].div.css("background-color","lightgray"),this.saveViewsToDataServer(function(){console.log("ViewPieceList.makeNewView success"),e.viewPiece[t].div.css("background-color",""),y()("#jolecule-views").stop(),y()("#jolecule-views").scrollTo(e.viewPiece[t].div,1e3,{offset:{top:-80}})})}}]),e}());!function(){function e(t,i,s,r){var n=this;f()(this,e),this.viewsDisplayTag=s,this.sequenceDisplayTag=i,this.params={divTag:t,viewId:"",viewHeight:170,isViewTextShown:!1,isEditable:!0,isLoop:!1,isGrid:!0,backgroundColor:13421772},console.log("FullPageJolecule.constructor params",r),N(r)&&(this.params=b.a.assign(this.params,r)),this.embedJolecule=new Mt(this.params),document.oncontextmenu=b.a.noop,document.onkeydown=function(e){return n.onkeydown(e)};var a=function(){n.resize()};y()(window).resize(a),window.onorientationchange=a,this.noData=!0}g()(e,[{key:"asyncAddDataServer",value:function(){var e=v()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.embedJolecule.asyncAddDataServer(t);case 2:this.initViewsDisplay(t),console.log("FullPageJolecule.asyncAddDataServer finished adding views");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"initViewsDisplay",value:function(e){if(this.noData){this.noData=!1,this.soupView=this.embedJolecule.soupView,this.controller=this.embedJolecule.controller,this.display=this.embedJolecule.display,this.viewsDisplay=new Ot(this.viewsDisplayTag,this.controller,this.display,e,this.params.isEditable),this.viewsDisplay.makeAllViews();var t=F().split("#")[1];t in this.soupView.savedViewsByViewId?this.viewsDisplay.setTargetByViewId(t):this.viewsDisplay.setTargetByViewId("view:000000"),this.viewsDisplay.updateViews()}this.resize()}},{key:"isChanged",value:function(){return void 0!==this.soupView&&this.soupView.changed}},{key:"draw",value:function(){this.soupView.changed&&(this.viewsDisplay.updateViews(),this.embedJolecule.draw(),this.soupView.changed=!1)}},{key:"animate",value:function(){void 0!==this.embedJolecule&&this.embedJolecule.animate()}},{key:"resize",value:function(e){void 0!==this.soupView&&(this.soupView.changed=!0),void 0!==this.embedJolecule&&this.embedJolecule.resize()}},{key:"gotoPrevResidue",value:function(){this.controller.setTargetToPrevResidue()}},{key:"gotoNextResidue",value:function(){this.controller.setTargetToNextResidue()}},{key:"onkeydown",value:function(e){if(!window.keyboard_lock){var t=String.fromCharCode(e.keyCode).toUpperCase();if("V"===t)return void this.viewsDisplay.makeNewView();if("K"===t||37===e.keyCode)this.gotoPrevResidue();else if("J"===t||39===e.keyCode)this.gotoNextResidue();else if(38===e.keyCode)this.viewsDisplay.gotoPrevView();else if(" "===t||40===e.keyCode)this.viewsDisplay.gotoNextView();else if("B"===t)this.soupView.currentView.show.backboneAtom?this.controller.setBackboneOption("ribbon"):this.soupView.currentView.show.ribbon?this.controller.setBackboneOption("trace"):this.soupView.currentView.show.trace&&this.controller.setBackboneOption("backboneAtom");else if("L"===t)this.controller.toggleShowOption("ligands");else if("S"===t)this.controller.toggleShowOption("sidechain");else if("W"===t)this.controller.toggleShowOption("water");else if("C"===t)this.display.controller.clearSelectedResidues();else if("E"===t){var i=this.display.soupView.iLastViewSelected;if(i>0){var s=this.display.soupView.savedViews[i].id;this.viewsDisplay.div[s].edit_fn()}}else if("N"===t)this.display.controller.toggleResidueNeighbors();else if("A"===t)this.display.atomLabelDialog();else{var r=parseInt(t)-1;if((r||0===r)&&r<this.soupView.savedViews.length){var n=this.soupView.savedViews[r].id;this.viewsDisplay.setTargetByViewId(n)}}this.display.soupView.changed=!0}}}])}();function It(e){var t=b.a.merge(Et,e),i=new Mt(t);return o(i),i}i.d(t,"a",function(){return It})},mUlb:function(e,t){},olkN:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray__=__webpack_require__("d7EF"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_entries__=__webpack_require__("W3Iv"),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_entries___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_entries__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator__=__webpack_require__("Xxa5"),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_promise__=__webpack_require__("//Fk"),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator__=__webpack_require__("exGp"),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator__),__WEBPACK_IMPORTED_MODULE_6_vue__=__webpack_require__("7+uW"),__WEBPACK_IMPORTED_MODULE_7_vuex__=__webpack_require__("NYxO");__WEBPACK_IMPORTED_MODULE_6_vue__.a.use(__WEBPACK_IMPORTED_MODULE_7_vuex__.a);var store=new __WEBPACK_IMPORTED_MODULE_7_vuex__.a.Store({state:{user:{authenticated:!1},loginMessage:"",isWorking:!1,isSearchSubmitted:!1,searchQuery:{},searchPagination:{sortBy:"pdb",descending:!1,rowsPerPage:10,totalItems:0},searchResults:[],searchErrors:[],totalResults:0,pdb:"1be9",energyCutoffSet:"high",dataServers:[],elements:[{value:"He",text:"Helium"},{value:"Ne",text:"Neon"},{value:"Ar",text:"Argon"},{value:"Kr",text:"Krypton"},{value:"Xe",text:"Xenon"}],energyCutoffSets:[{value:"veryHigh",text:"veryHigh"},{value:"high",text:"high"},{value:"medium",text:"medium"},{value:"low",text:"low"}]},getters:{errors:function(e){return e.errors},loginMessage:function(e){return e.loginMessage},isWorking:function(e){return e.isWorking},isSearchSubmitted:function(e){return e.isSearchSubmitted},searchQuery:function(e){return e.searchQuery},searchPagination:function(e){return e.searchPagination},searchResults:function(e){return e.searchResults},searchErrors:function(e){return e.searchErrors},totalResults:function(e){return e.totalResults},pdb:function(e){return e.pdb},energyCutoffSet:function(e){return e.energyCutoffSet},energyCutoffSets:function(e){return e.energyCutoffSets},elements:function(e){return e.elements}},mutations:{setUser:function(e,t){e.user=t},SET_ISWORKING:function(e,t){e.isWorking=t},SET_ISSEARCHSUBMITTED:function(e,t){e.isSearchSubmitted=t},SET_PDB:function(e,t){e.pdb=t},SET_ENERGYCUTOFFSET:function(e,t){e.energyCutoffSet=t},SET_SEARCHQUERY:function(e,t){e.searchQuery=t},SET_SEARCHPAGINATION:function(e,t){e.searchPagination=t},SET_DATASERVERS:function(e,t){e.dataServers=t},SET_SEARCHRESULTS:function(e,t){e.searchResults=t},SET_SEARCHERRORS:function(e,t){e.searchErrors=t},SET_TOTALRESULTS:function(e,t){e.totalResults=t}},actions:{refreshDataServers:function refreshDataServers(_ref){var _this=this,commit=_ref.commit,state=_ref.state;return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function _callee(){var dataServers,i,url;return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:for(dataServers=[],i=0;i<=5;i++)url="http://localhost:8081/api/dataServer/"+state.pdb+"/"+state.energyCutoffSet+"/"+i+"/",dataServers[i]=axios.get(url).then(function(response){var dataServerFn=response.data,dataServer=eval(dataServerFn);return dataServer});return _context.t0=commit,_context.next=5,__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_promise___default.a.all(dataServers);case 5:_context.t1=_context.sent,(0,_context.t0)("SET_DATASERVERS",_context.t1);case 7:case"end":return _context.stop()}},_callee,_this)}))()},search:function(e){var t=this,i=e.commit,s=e.state;return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function e(){var r,n,a,o,u,l,h,c,d;return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.searchQuery&&s.searchPagination){e.next=3;break}return i("SET_SEARCHERRORS","No query found"),e.abrupt("return");case 3:return r=s.searchPagination,n=r.sortBy,a=r.descending,o=r.page,u=r.rowsPerPage,l="",h=s.searchQuery,c=s.searchPagination,i("SET_SEARCHPAGINATION",c),i("SET_ISWORKING",!0),i("SET_SEARCHERRORS",""),h.limit=u,h.offset=(o-1)*u,h.sort=n?n+" "+(a?"DESC":"ASC"):"",i("SET_SEARCHQUERY",h),l="?"+__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_entries___default()(h).filter(function(e){var t=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray___default()(e,2);t[0];return t[1]}).map(function(e){var t=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_slicedToArray___default()(e,2);return t[0]+"="+t[1]}).join("&"),d="http://localhost:8081/api/nobleGasBindings/search"+l,console.log("getting response to",l),e.next=19,axios.get(d).then(function(e){e.data.error?(i("SET_TOTALRESULTS",0),i("SET_SEARCHRESULTS",{}),i("SET_SEARCHERRORS",__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e.data.error,null,2))):(i("SET_TOTALRESULTS",e.data.count),i("SET_SEARCHRESULTS",e.data.rows),0==s.totalResults&&i("SET_SEARCHERRORS","Try a different set of search terms."+__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(h,null,2))),c.totalItems=s.totalResults,i("SET_SEARCHPAGINATION",c),i("SET_ISWORKING",!1),console.log("got response",t)});case 19:case"end":return e.stop()}},e,t)}))()},updatePDB:function(e,t){var i=this,s=e.commit,r=e.dispatch;return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function e(){return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s("SET_PDB",t),e.next=3,r("refreshDataServers");case 3:case"end":return e.stop()}},e,i)}))()},updateEnergyCutOffSet:function(e,t){var i=this,s=e.commit,r=e.dispatch;return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function e(){return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s("SET_ENERGYCUTOFFSET",t),e.next=3,r("refreshDataServers");case 3:case"end":return e.stop()}},e,i)}))()},updateView:function(e,t){var i=this,s=e.commit,r=e.dispatch,n=t.pdb;t.energyCutOffSet;return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function e(){return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s("SET_PDB",n),s("SET_ENERGYCUTOFFSET",energyCutoffSet),e.next=4,r("refreshDataServers");case 4:case"end":return e.stop()}},e,i)}))()}}});__webpack_exports__.a=store},uvxf:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.f9f8f57fe561773cf7a3.js.map